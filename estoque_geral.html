<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estoque Geral - Marquespan</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="css/estoque_geral.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon" href="logo.png" type="image/png">
  <!-- Bibliotecas para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- O menu será injetado aqui pelo menu.js -->
    <div id="menu-container"></div>

    <div class="main-content">
      <div class="glass-header">
        <h1><i class="fas fa-boxes"></i> Estoque Geral</h1>
        <a href="dashboard.html" class="btn-glass btn-blue"><i class="fas fa-arrow-left"></i> Voltar</a>
      </div>

      <!-- Navegação por Abas -->
      <div class="painel-navegacao">
        <button class="painel-btn active" data-tab="tab-estoque-atual" aria-selected="true"><i class="fas fa-boxes"></i> Estoque Atual</button>
        <button class="painel-btn" data-tab="tab-retirada" aria-selected="false"><i class="fas fa-dolly"></i> Retirada do Estoque</button>
        <button class="painel-btn" data-tab="tab-batimento" aria-selected="false"><i class="fas fa-clipboard-check"></i> Batimento</button>
        <button class="painel-btn" data-tab="tab-relatorios" aria-selected="false"><i class="fas fa-chart-line"></i> Relatórios</button>
      </div>

      <section class="section">
      <!-- ABA 1: ESTOQUE ATUAL -->
      <section id="tab-estoque-atual" class="tab-content">
        <!-- Card de Filtros Compacto -->
        <div class="glass-panel">
          <h4>
            <i class="fas fa-search"></i> Pesquisar Estoque
          </h4>
          <div class="grid-filtros">
            <div class="form-group" style="flex-grow: 1;">
                <label>Código</label>
                <input type="text" id="filtro-codigo" class="glass-input" placeholder="Código...">
            </div>
            <div class="form-group" style="grid-column: span 2;">
                <label>Nome do Produto</label>
                <input type="text" id="filtro-nome" class="glass-input" placeholder="Nome...">
            </div>
            <div class="form-group">
                <button id="btn-buscar-estoque" class="btn-glass btn-green" style="width: 100%;"><i class="fas fa-search"></i> Buscar</button>
            </div>
            <div class="form-group">
                <button id="btn-limpar-filtros" class="btn-glass btn-muted" style="width: 100%;"><i class="fas fa-eraser"></i> Limpar</button>
            </div>
          </div>
        </div>

        <div class="glass-panel">
          <h4 style="margin-bottom: 15px;">Itens em Estoque</h4>
          <div class="table-responsive">
            <table class="glass-table">
              <thead>
                <tr>
                  <th>Código</th>
                  <th>Nome do Produto</th>
                  <th>Unidade</th>
                  <th style="text-align: center;">Quantidade em Estoque</th>
                </tr>
              </thead>
              <tbody id="grid-estoque-body">
                <!-- Dados serão carregados aqui -->
              </tbody>
            </table>
          </div>
          <div class="grid-footer" style="margin-top: 10px; text-align: right; font-size: 0.9rem; color: #666;">
            Total de Itens Listados: <span id="total-itens" style="font-weight: bold;">0</span>
          </div>
        </div>
      </section>

      <!-- ABA 2: RETIRADA DO ESTOQUE -->
      <section id="tab-retirada" class="tab-content hidden">
        <!-- Card Superior: Informações -->
        <div class="glass-panel" style="padding: 10px 20px;">
          <div class="info-bar" style="margin-bottom: 0; background: transparent;">
            <div>
              <i class="fas fa-user-circle"></i> <strong>Usuário:</strong> <span id="retirada-usuario-logado">...</span>
            </div>
            <div>
              <i class="fas fa-calendar-alt"></i> <strong>Data:</strong> <span id="retirada-data">...</span>
              <i class="fas fa-clock" style="margin-left: 10px;"></i> <span id="retirada-hora">...</span>
            </div>
          </div>
        </div>

        <!-- Área de Adição de Produtos (Compacto) -->
        <div class="glass-panel">
          <h4>
            <i class="fas fa-cart-plus"></i> Adicionar Produtos
          </h4>
          <div class="grid-filtros">
            <div class="form-group" style="grid-column: span 2;">
              <label>Produto</label>
              <input type="text" id="retirada-produto" list="lista-produtos-retirada" class="glass-input" placeholder="Digite para buscar..." autocomplete="off">
              <datalist id="lista-produtos-retirada"></datalist>
              <input type="hidden" id="retirada-produto-id">
            </div>
            <div class="form-group">
              <label>Estoque Atual</label>
              <input type="text" id="retirada-estoque-atual" class="glass-input" readonly style="background-color: rgba(0,0,0,0.05); font-weight: bold; color: #006937;">
            </div>
            <div class="form-group">
              <label>Qtd. Retirada</label>
              <input type="number" id="retirada-quantidade" class="glass-input" min="0.01" step="0.01">
            </div>
            <div class="form-group">
              <button id="btn-adicionar-item-retirada" class="btn-glass btn-green" style="width: 100%;"><i class="fas fa-plus"></i> Adicionar</button>
            </div>
          </div>
        </div>

        <!-- Grid de Itens (Carrinho) -->
        <div class="glass-panel" style="min-height: 250px; display: flex; flex-direction: column;">
          <div class="table-responsive" style="flex-grow: 1;">
            <table class="glass-table">
              <thead>
                <tr>
                  <th>Código</th>
                  <th>Produto</th>
                  <th style="text-align: center;">Qtd.</th>
                  <th style="text-align: center;">Ações</th>
                </tr>
              </thead>
              <tbody id="grid-itens-retirada">
                <!-- Itens adicionados via JS -->
              </tbody>
            </table>
          </div>
          <div style="text-align: right; margin-top: 10px; font-size: 1.1em; padding: 10px; border-top: 1px solid rgba(0,0,0,0.1);">
            <strong>Total de Itens:</strong> <span id="total-itens-retirada" style="font-weight: bold; color: #006937;">0</span>
          </div>
        </div>

        <!-- Card de Ação (Finalizar) -->
        <div class="glass-panel">
          <h4>
            <i class="fas fa-check-circle"></i> Finalizar Retirada
          </h4>
          <div class="grid-filtros">
            <div class="form-group">
              <label>Retirado Por (Nome Legível)</label>
              <input type="text" id="retirada-responsavel" class="glass-input" placeholder="Quem está levando a peça?" oninput="this.value = this.value.toUpperCase()">
            </div>
            <div class="form-group" style="grid-column: span 2;">
              <label>Observação / Motivo</label>
              <input type="text" id="retirada-observacao" class="glass-input" placeholder="Opcional" oninput="this.value = this.value.toUpperCase()">
            </div>
          </div>
          <div class="form-actions" style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
            <button id="btn-registrar-saida" class="btn-glass btn-red"><i class="fas fa-save"></i> Registrar Saída</button>
            <button id="btn-gerar-pdf-saida" class="btn-glass btn-muted" disabled style="cursor: not-allowed;"><i class="fas fa-file-pdf"></i> Gerar PDF</button>
          </div>
        </div>
      </section>

      <!-- ABA 3: BATIMENTO (CONTAGEM) -->
      <section id="tab-batimento" class="tab-content hidden">
        <div class="glass-panel">
          <h4>
            <i class="fas fa-clipboard-check"></i> Batimento de Estoque (Ajuste)
          </h4>
          <p style="color: #666; margin-bottom: 15px; font-size: 0.85em;">Use esta função para corrigir a quantidade em estoque após uma contagem física.</p>
          <form id="form-batimento">
            <div class="grid-filtros">
              <div class="form-group" style="grid-column: span 2;">
                <label>Produto</label>
                <input type="text" id="batimento-produto" list="lista-produtos-batimento" class="glass-input" placeholder="Digite para buscar..." required autocomplete="off">
                <datalist id="lista-produtos-batimento"></datalist>
                <input type="hidden" id="batimento-produto-id">
              </div>
              <div class="form-group">
                <label>Estoque no Sistema</label>
                <input type="text" id="batimento-estoque-atual" class="glass-input" readonly style="background-color: rgba(0,0,0,0.05);">
              </div>
              <div class="form-group">
                <label>Qtd. Contada (Real)</label>
                <input type="number" id="batimento-nova-quantidade" class="glass-input" min="0" step="0.01" required>
              </div>
              <div class="form-group">
                <button type="submit" class="btn-glass btn-orange" style="width: 100%;"><i class="fas fa-sync-alt"></i> Atualizar</button>
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- ABA 4: RELATÓRIOS -->
      <section id="tab-relatorios" class="tab-content hidden">
        <!-- Card de Filtros Compacto -->
        <div class="glass-panel">
          <h4>
            <i class="fas fa-filter"></i> Filtros de Pesquisa
          </h4>
          <div class="grid-filtros">
            <div class="form-group">
              <label>Data Início</label>
              <input type="date" id="relatorio-data-ini" class="glass-input">
            </div>
            <div class="form-group">
              <label>Data Fim</label>
              <input type="date" id="relatorio-data-fim" class="glass-input">
            </div>
            <div class="form-group">
              <label>Tipo</label>
              <select id="relatorio-tipo" class="glass-input">
                <option value="">Todos os Tipos</option>
                <option value="ENTRADA">Entrada</option>
                <option value="SAIDA">Saída (Retirada)</option>
                <option value="BATIMENTO">Batimento (Ajuste)</option>
              </select>
            </div>
            <div class="form-group" style="flex-grow: 1;">
              <label>Busca (Produto/NF/Obs)</label>
              <input type="text" id="relatorio-busca" class="glass-input" placeholder="Digite para pesquisar...">
            </div>
            <div class="form-group">
              <button id="btn-buscar-relatorio" class="btn-glass btn-blue" style="width: 100%;"><i class="fas fa-search"></i> Filtrar</button>
            </div>
          </div>
        </div>

        <!-- Resumo do Período -->
        <div class="relatorio-resumo">
            <div class="resumo-card entrada">
                <h5><i class="fas fa-arrow-down"></i> Total Entradas</h5>
                <div class="valor" id="resumo-entrada">0</div>
            </div>
            <div class="resumo-card saida">
                <h5><i class="fas fa-arrow-up"></i> Total Saídas</h5>
                <div class="valor" id="resumo-saida">0</div>
            </div>
            <div class="resumo-card batimento">
                <h5><i class="fas fa-clipboard-check"></i> Ajustes (Batimentos)</h5>
                <div class="valor" id="resumo-batimento">0</div>
            </div>
        </div>

        <div class="glass-panel">
          <h4 style="margin-bottom: 15px;">Histórico de Movimentações</h4>
          <div class="table-responsive">
            <table class="glass-table">
              <thead>
                <tr>
                  <th>Data/Hora</th>
                  <th>Produto</th>
                  <th>Tipo</th>
                  <th>Qtd. Mov.</th>
                  <th>Saldo Anterior</th>
                  <th>Saldo Novo</th>
                  <th>Usuário</th>
                  <th>Detalhes</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="grid-relatorio-body">
                <!-- Dados carregados via JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>
      </section>

    </div>
  </div>
  <footer class="footer">&copy; 2025 GTSYSTEM - Marquespan. Todos os direitos reservados.</footer>
  <script type="module" src="./script/menu.js" defer></script>
  <script type="module" src="script/estoque_geral.js"></script>
</body>
</html>