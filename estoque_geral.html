<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estoque Geral - Marquespan</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="css/estoque_geral.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon" href="logo.png" type="image/png">
  <!-- Bibliotecas para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- O menu ser√° injetado aqui pelo menu.js -->
    <div id="menu-container"></div>

    <div class="main-content">
      <header class="header">üì¶ Estoque Geral</header>

      <!-- Navega√ß√£o por Abas -->
      <div class="painel-navegacao">
        <button class="painel-btn active" data-tab="tab-estoque-atual" aria-selected="true"><i class="fas fa-boxes"></i> Estoque Atual</button>
        <button class="painel-btn" data-tab="tab-retirada" aria-selected="false"><i class="fas fa-dolly"></i> Retirada do Estoque</button>
        <button class="painel-btn" data-tab="tab-batimento" aria-selected="false"><i class="fas fa-clipboard-check"></i> Batimento</button>
        <button class="painel-btn" data-tab="tab-relatorios" aria-selected="false"><i class="fas fa-chart-line"></i> Relat√≥rios</button>
      </div>

      <!-- ABA 1: ESTOQUE ATUAL -->
      <section id="tab-estoque-atual" class="tab-content">
        <!-- Card de Filtros Compacto -->
        <div class="card" style="max-width: 900px; margin: 20px auto 20px auto; padding: 15px; border-left: 4px solid #006937;">
          <h4 style="margin-top: 0; margin-bottom: 15px; color: #555; font-size: 1em; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <i class="fas fa-search"></i> Pesquisar Estoque
          </h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; align-items: end;">
            <div style="flex-grow: 1;">
                <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">C√≥digo</label>
                <input type="text" id="filtro-codigo" placeholder="C√≥digo..." style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="grid-column: span 2;">
                <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Nome do Produto</label>
                <input type="text" id="filtro-nome" placeholder="Nome..." style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
                <button id="btn-buscar-estoque" class="btn-primary" style="width: 100%; padding: 6px; font-size: 0.9em; justify-content: center;"><i class="fas fa-search"></i> Buscar</button>
            </div>
            <div>
                <button id="btn-limpar-filtros" class="btn-muted" style="width: 100%; padding: 6px; font-size: 0.9em; justify-content: center;"><i class="fas fa-eraser"></i> Limpar</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 style="margin-bottom: 20px; font-size: 1.2em; color: #333;">Itens em Estoque</h2>
          <div class="table-responsive">
            <table class="data-grid">
              <thead>
                <tr>
                  <th>C√≥digo</th>
                  <th>Nome do Produto</th>
                  <th>Unidade</th>
                  <th style="text-align: center;">Quantidade em Estoque</th>
                </tr>
              </thead>
              <tbody id="grid-estoque-body">
                <!-- Dados ser√£o carregados aqui -->
              </tbody>
            </table>
          </div>
          <div class="grid-footer" style="margin-top: 10px; text-align: right;">
            Total de Itens Listados: <span id="total-itens" style="font-weight: bold;">0</span>
          </div>
        </div>
      </section>

      <!-- ABA 2: RETIRADA DO ESTOQUE -->
      <section id="tab-retirada" class="tab-content hidden">
        <!-- Card Superior: Informa√ß√µes -->
        <div class="card" style="max-width: 900px; margin: 20px auto 15px auto; padding: 10px 15px; border-left: 4px solid #17a2b8; background-color: #f8f9fa;">
          <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; font-size: 0.9em;">
            <div>
              <i class="fas fa-user-circle"></i> <strong>Usu√°rio:</strong> <span id="retirada-usuario-logado">...</span>
            </div>
            <div>
              <i class="fas fa-calendar-alt"></i> <strong>Data:</strong> <span id="retirada-data">...</span>
              <i class="fas fa-clock" style="margin-left: 10px;"></i> <span id="retirada-hora">...</span>
            </div>
          </div>
        </div>

        <!-- √Årea de Adi√ß√£o de Produtos (Compacto) -->
        <div class="card" style="max-width: 900px; margin: 0 auto 20px auto; padding: 15px; border-left: 4px solid #006937;">
          <h4 style="margin-top: 0; margin-bottom: 15px; color: #555; font-size: 1em; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <i class="fas fa-cart-plus"></i> Adicionar Produtos
          </h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; align-items: end;">
            <div style="grid-column: span 2;">
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Produto</label>
              <input type="text" id="retirada-produto" list="lista-produtos-retirada" placeholder="Digite para buscar..." autocomplete="off" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
              <datalist id="lista-produtos-retirada"></datalist>
              <input type="hidden" id="retirada-produto-id">
            </div>
            <div>
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Estoque Atual</label>
              <input type="text" id="retirada-estoque-atual" readonly style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px; background-color: #e9ecef; font-weight: bold; color: #006937;">
            </div>
            <div>
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Qtd. Retirada</label>
              <input type="number" id="retirada-quantidade" min="0.01" step="0.01" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <button id="btn-adicionar-item-retirada" class="btn-primary" style="width: 100%; padding: 6px; font-size: 0.9em; justify-content: center;"><i class="fas fa-plus"></i> Adicionar</button>
            </div>
          </div>
        </div>

        <!-- Grid de Itens (Carrinho) -->
        <div class="card" style="min-height: 250px; display: flex; flex-direction: column;">
          <div class="table-responsive" style="flex-grow: 1;">
            <table class="data-grid">
              <thead>
                <tr>
                  <th>C√≥digo</th>
                  <th>Produto</th>
                  <th style="text-align: center;">Qtd.</th>
                  <th style="text-align: center;">A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="grid-itens-retirada">
                <!-- Itens adicionados via JS -->
              </tbody>
            </table>
          </div>
          <div style="text-align: right; margin-top: 10px; font-size: 1.1em; padding: 10px; background: #f8f9fa; border-top: 2px solid #006937;">
            <strong>Total de Itens:</strong> <span id="total-itens-retirada" style="font-weight: bold; color: #006937;">0</span>
          </div>
        </div>

        <!-- Card de A√ß√£o (Finalizar) -->
        <div class="card" style="max-width: 900px; margin: 20px auto 0 auto; padding: 15px; border-left: 4px solid #dc3545;">
          <h4 style="margin-top: 0; margin-bottom: 15px; color: #555; font-size: 1em; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <i class="fas fa-check-circle"></i> Finalizar Retirada
          </h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; align-items: end;">
            <div>
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Retirado Por (Nome Leg√≠vel)</label>
              <input type="text" id="retirada-responsavel" placeholder="Quem est√° levando a pe√ßa?" oninput="this.value = this.value.toUpperCase()" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="grid-column: span 2;">
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Observa√ß√£o / Motivo</label>
              <input type="text" id="retirada-observacao" placeholder="Opcional" oninput="this.value = this.value.toUpperCase()" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
            </div>
          </div>
          <div class="form-actions" style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
            <button id="btn-registrar-saida" class="btn-primary" style="background-color: #dc3545; border-color: #dc3545; padding: 8px 15px; font-size: 0.9em;"><i class="fas fa-save"></i> Registrar Sa√≠da</button>
            <button id="btn-gerar-pdf-saida" class="btn-primary" disabled style="background-color: #6c757d; border-color: #6c757d; cursor: not-allowed; padding: 8px 15px; font-size: 0.9em;"><i class="fas fa-file-pdf"></i> Gerar PDF</button>
          </div>
        </div>
      </section>

      <!-- ABA 3: BATIMENTO (CONTAGEM) -->
      <section id="tab-batimento" class="tab-content hidden">
        <div class="card" style="max-width: 900px; margin: 20px auto 20px auto; padding: 15px; border-left: 4px solid #fd7e14;">
          <h4 style="margin-top: 0; margin-bottom: 15px; color: #555; font-size: 1em; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <i class="fas fa-clipboard-check"></i> Batimento de Estoque (Ajuste)
          </h4>
          <p style="color: #666; margin-bottom: 15px; font-size: 0.85em;">Use esta fun√ß√£o para corrigir a quantidade em estoque ap√≥s uma contagem f√≠sica.</p>
          <form id="form-batimento">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; align-items: end;">
              <div style="grid-column: span 2;">
                <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Produto</label>
                <input type="text" id="batimento-produto" list="lista-produtos-batimento" placeholder="Digite para buscar..." required autocomplete="off" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
                <datalist id="lista-produtos-batimento"></datalist>
                <input type="hidden" id="batimento-produto-id">
              </div>
              <div>
                <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Estoque no Sistema</label>
                <input type="text" id="batimento-estoque-atual" readonly style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px; background-color: #e9ecef;">
              </div>
              <div>
                <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Qtd. Contada (Real)</label>
                <input type="number" id="batimento-nova-quantidade" min="0" step="0.01" required style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px; border-color: #fd7e14;">
              </div>
              <div>
                <button type="submit" class="btn-primary" style="width: 100%; padding: 6px; font-size: 0.9em; justify-content: center; background-color: #fd7e14; border-color: #fd7e14;"><i class="fas fa-sync-alt"></i> Atualizar</button>
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- ABA 4: RELAT√ìRIOS -->
      <section id="tab-relatorios" class="tab-content hidden">
        <!-- Card de Filtros Compacto -->
        <div class="card" style="max-width: 900px; margin: 20px auto 20px auto; padding: 15px; border-left: 4px solid #006937;">
          <h4 style="margin-top: 0; margin-bottom: 15px; color: #555; font-size: 1em; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <i class="fas fa-filter"></i> Filtros de Pesquisa
          </h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; align-items: end;">
            <div>
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Data In√≠cio</label>
              <input type="date" id="relatorio-data-ini" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Data Fim</label>
              <input type="date" id="relatorio-data-fim" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label style="display: block; font-size: 0.8em; font-weight: bold; color: #666; margin-bottom: 3px;">Tipo</label>
              <select id="relatorio-tipo" style="width: 100%; padding: 6px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px;">
                <option value="">Todos os Tipos</option>
                <option value="ENTRADA">Entrada</option>
                <option value="SAIDA">Sa√≠da (Retirada)</option>
                <option value="BATIMENTO">Batimento (Ajuste)</option>
              </select>
            </div>
            <div>
              <button id="btn-buscar-relatorio" class="btn-primary" style="width: 100%; padding: 6px; font-size: 0.9em; justify-content: center;"><i class="fas fa-search"></i> Filtrar</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 style="margin-bottom: 20px; font-size: 1.2em; color: #333;">Hist√≥rico de Movimenta√ß√µes</h2>
          <div class="table-responsive">
            <table class="data-grid">
              <thead>
                <tr>
                  <th>Data/Hora</th>
                  <th>Produto</th>
                  <th>Tipo</th>
                  <th>Qtd. Mov.</th>
                  <th>Saldo Anterior</th>
                  <th>Saldo Novo</th>
                  <th>Usu√°rio</th>
                  <th>Detalhes</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="grid-relatorio-body">
                <!-- Dados carregados via JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

    </div>
  </div>
  <footer class="footer">¬© 2025 Marquespan. Todos os direitos reservados.</footer>
  <script type="module" src="./script/menu.js" defer></script>
  <script type="module" src="script/estoque_geral.js"></script>
</body>
</html>