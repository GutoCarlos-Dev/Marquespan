<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Abastecimento - Marquespan</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="css/comodato.css" /> <!-- Reutilizando layout de grid -->
  <link rel="stylesheet" href="css/abastecimento.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon" href="logo.png" type="image/png">
  <style>
    /* Estilos para fixar o cabeçalho e adicionar scroll na tabela de histórico */
    #containerHistoricoEntrada {
      max-height: 400px; /* Define a altura fixa da área visível */
      overflow-y: auto;  /* Adiciona a barra de rolagem vertical */
    }
    #containerHistoricoEntrada thead th {
      position: sticky;
      top: 0;
      background-color: #f1f1f1; /* Cor de fundo para o cabeçalho não ficar transparente */
      z-index: 5;
      box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1); /* Sombra suave para destacar o cabeçalho */
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- O menu será injetado aqui pelo menu.js -->
    
    <div class="main-content">
      <header class="header"><i class="fas fa-gas-pump"></i> Movimentação de Combustível</header>

      <!-- Navegação por abas -->
      <div class="painel-navegacao" role="tablist" id="menu-abastecimento">
        <button class="painel-btn active" data-secao="sectionEstoque" aria-selected="true">
          <i class="fas fa-tachometer-alt"></i> Estoque Atual
        </button>
        <button class="painel-btn" data-secao="sectionEntrada" aria-selected="false">
          <i class="fas fa-arrow-down"></i> Entrada de Combustível
        </button>
        <button class="painel-btn" data-secao="sectionSaida" aria-selected="false">
          <i class="fas fa-arrow-up"></i> Saída de Combustível
        </button>
      </div>

      <!-- SEÇÃO: ESTOQUE ATUAL (PRIMEIRA ABA) -->
      <section id="sectionEstoque" class="section">
        <div class="card">
          <div class="card-header">
            <h2><i class="fas fa-ruler-vertical"></i> Atualização de Estoque</h2>
          </div>
          <p style="color: #666; margin-bottom: 15px;">Informe a litragem física atual dos tanques antes de realizar movimentações, caso necessário (Ajuste de Inventário).</p>
          
          <div class="table-responsive">
            <table class="data-grid">
              <thead>
                <tr>
                  <th>Tanque</th>
                  <th>Combustível</th>
                  <th>Capacidade Máx.</th>
                  <th>Estoque Atual (Litros)</th>
                </tr>
              </thead>
              <tbody id="tbodyEstoqueAtual">
                <!-- Preenchido via JS -->
              </tbody>
            </table>
          </div>
          <div class="form-actions" style="margin-top: 20px; justify-content: flex-end; display: flex;">
            <button type="button" id="btnSalvarEstoque" class="btn-primary"><i class="fas fa-save"></i> Atualizar Estoque</button>
          </div>
        </div>
      </section>

      <!-- SEÇÃO: ENTRADA -->
      <section id="sectionEntrada" class="section hidden">
        <div class="card card-header">
          <h2>Novo Abastecimento</h2>
        </div>

        <div class="card grid-2-comodato">
          <!-- Formulário -->
          <div>
            <h3>Dados da Entrada</h3>
            <form id="formAbastecimento" class="form-compact">
              <input type="hidden" id="abastecimentoEditingId">

              <label for="absData">Data e Hora</label>
              <input type="datetime-local" id="absData" required />

              <label for="absNota">Nº Nota Fiscal</label>
              <input type="text" id="absNota" placeholder="Ex: 123456" required />

              <div class="form-row-duplo">
                <div class="form-group">
                    <label for="absQtdTotalNota">Qtd. Total da Nota (Litros)</label>
                    <input type="number" id="absQtdTotalNota" step="0.01" min="0.01" inputmode="decimal" placeholder="0,00" required />
                </div>
                <div class="form-group">
                    <label for="absVlrLitro">Valor por Litro (R$)</label>
                    <input type="number" id="absVlrLitro" step="0.001" min="0.001" inputmode="decimal" placeholder="0,000" required />
                </div>
              </div>

              <label for="absTotal">Valor Total da Nota (Calculado)</label>
              <input type="text" id="absTotal" readonly style="background-color: #f0f0f0; font-weight: bold;" />

              <hr class="form-divider">

              <h4>Distribuição nos Tanques <span id="litros-restantes-display" class="litros-restantes">(A distribuir: <span id="litros-restantes-valor">0.00</span> L)</span></h4>
              <div id="distribuicao-container">
                <!-- Linhas de tanque serão adicionadas aqui via JS -->
              </div>
              <div class="distribuicao-actions">
                  <button type="button" id="btnAdicionarTanque" class="btn-secondary-outline"><i class="fas fa-plus"></i> Adicionar Tanque</button>
              </div>

              <div class="row-actions">
                <button type="submit" id="btnSalvarAbs" class="btn-primary"><i class="fas fa-save"></i> Registrar Entrada</button>
                <button type="button" id="btnLimparAbs" class="btn-muted"><i class="fas fa-eraser"></i> Limpar</button>
              </div>
            </form>
          </div>

          <!-- Tabela -->
          <div>
            <h3>Histórico de Abastecimentos</h3>
            <div class="table-responsive" id="containerHistoricoEntrada">
              <table class="data-grid">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Nº Nota</th>
                    <th>Tanque</th>
                    <th>Litros</th>
                    <th>Vlr. Litro</th>
                    <th>Total</th>
                    <th>Usuário</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="tableBodyAbastecimentos">
                  <!-- Preenchido via JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- SEÇÃO: SAÍDA -->
      <section id="sectionSaida" class="section hidden">
        <div class="card">
          <div class="card-header">
            <h2><i class="fas fa-tachometer-alt"></i> Registrar Saída (Abastecimento de Frota)</h2>
          </div>
          
          <form id="formSaidaCombustivel" class="form-mobile">
            <input type="hidden" id="saidaEditingId">

            <div class="form-group">
              <label for="saidaDataHora">Data e Hora</label>
              <input type="datetime-local" id="saidaDataHora" required />
            </div>

            <div class="form-group">
              <label for="saidaBico">Bico de Origem</label>
              <select id="saidaBico" required class="input-large">
                <option value="">Carregando bicos...</option>
              </select>
            </div>

            <div class="form-group">
              <label for="saidaVeiculo">Veículo (Placa)</label>
              <input type="text" id="saidaVeiculo" list="listaVeiculos" placeholder="Digite a placa..." required class="input-large" autocomplete="off" />
              <datalist id="listaVeiculos"></datalist>
            </div>

            <div class="form-group">
              <label for="saidaMotorista">Motorista</label>
              <input type="text" id="saidaMotorista" list="listaMotoristas" placeholder="Nome do motorista..." required class="input-large" autocomplete="off" />
              <datalist id="listaMotoristas"></datalist>
            </div>

            <div class="form-row-mobile">
              <div class="form-group">
                <label for="saidaKm">KM / Horímetro Atual</label>
                <input type="number" id="saidaKm" placeholder="Ex: 150000" inputmode="numeric" required class="input-large" />
              </div>
              <div class="form-group">
                <label for="saidaLitros">Litros Abastecidos</label>
                <input type="number" id="saidaLitros" step="0.01" placeholder="0.00" inputmode="decimal" required class="input-large highlight-input" />
              </div>
            </div>

            <div class="form-actions-mobile">
              <button type="submit" id="btnSalvarSaida" class="btn-primary btn-large btn-block">
                <i class="fas fa-gas-pump"></i> CONFIRMAR ABASTECIMENTO
              </button>
            </div>
          </form>
        </div>

        <!-- Histórico de Saídas -->
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h3><i class="fas fa-history"></i> Histórico de Saídas Recentes</h3>
            </div>
            <div class="table-responsive">
              <table class="data-grid">
                <thead>
                  <tr>
                    <th>Data/Hora</th>
                    <th>Veículo</th>
                    <th>Motorista</th>
                    <th>Litros</th>
                    <th>KM</th>
                    <th>Usuário</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="tableBodySaidas"></tbody>
              </table>
            </div>
        </div>
      </section>
    </div>
  </div>
  <script>
    // Função global para alternar o menu lateral no mobile
    window.toggleSidebar = function() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar) {
        sidebar.classList.toggle('mobile-open');
      }
    };
  </script>
  <script type="module" src="./script/menu.js" defer></script>
  <script type="module" src="./script/abastecimento.js"></script>
</body>
</html>