<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gest√£o de Compras - Marquespan</title>
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/compras.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

  <!-- Container para inje√ß√£o do Menu Lateral -->
  <div id="menu-container"></div>

  <!-- üß± Conte√∫do principal -->
  <main class="main-content">
    <header class="header glass-header">
      <h1><i class="fas fa-shopping-cart"></i> Gest√£o de Compras</h1>
    </header>

    <!-- Navega√ß√£o por Abas -->
    <div class="painel-navegacao" id="menu-compras">
      <button class="painel-btn active" data-secao="sectionRealizarCotacoes"><i class="fas fa-file-invoice-dollar"></i> Realizar Cota√ß√£o</button>
      <button class="painel-btn" data-secao="sectionCotacoesSalvas"><i class="fas fa-history"></i> Cota√ß√µes Salvas</button>
      <button class="painel-btn" data-secao="sectionCadastrarProdutos"><i class="fas fa-box"></i> Produtos</button>
      <button class="painel-btn" data-secao="sectionCadastrarFornecedor"><i class="fas fa-truck"></i> Fornecedores</button>
    </div>

    <!-- SE√á√ÉO: REALIZAR COTA√á√ÉO -->
    <section id="sectionRealizarCotacoes" class="glass-panel">
      <div class="cotacao-header">
        <h3>Nova Cota√ß√£o</h3>
        <input type="text" id="quotationCode" readonly placeholder="C√≥digo" class="glass-input code-input">
      </div>

      <div class="quotation-layout">
        <!-- Card Esquerdo: Adicionar Produtos -->
        <div class="quotation-card left-card">
            <h4><i class="fas fa-cart-plus"></i> Produtos</h4>
            
            <div class="form-grid compact-form-grid">
                <div class="form-group" style="flex-grow: 1; margin-bottom: 0;">
                    <input type="text" id="cartProductInput" list="productList" placeholder="Buscar Produto..." class="glass-input compact-input">
                    <datalist id="productList"></datalist>
                </div>
                <div class="form-group" style="width: 70px; margin-bottom: 0;">
                    <input type="number" id="cartQtd" placeholder="Qtd" min="1" class="glass-input compact-input">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <button id="btnAddToCart" class="btn-glass btn-green compact-btn"><i class="fas fa-plus"></i></button>
                </div>
            </div>

            <div class="table-responsive cart-table-container compact-table-container">
                <table class="glass-table compact-table">
                    <thead>
                        <tr>
                            <th>C√ìD</th>
                            <th>PROD</th>
                            <th>QTD</th>
                            <th>UN</th>
                            <th style="width: 40px;"></th>
                        </tr>
                    </thead>
                    <tbody id="cartBody"></tbody>
                </table>
            </div>
            <div style="text-align: right; margin-top: 10px;">
                <button id="btnClearCart" class="btn-glass btn-red compact-btn"><i class="fas fa-trash"></i> Limpar</button>
            </div>
        </div>

        <!-- Card Direito: Fornecedores -->
        <div class="quotation-card right-card">
            <h4><i class="fas fa-store"></i> Fornecedores</h4>
            <div id="orccardrow" class="suppliers-grid">
                <!-- Preenchido via JS -->
            </div>
        </div>
      </div>

      <div class="form-actions" style="margin-top: 20px;">
        <button id="btnExportPdf" class="btn-glass btn-blue"><i class="fas fa-file-pdf"></i> Gerar PDF</button>
        <button id="btnRegistrarCotacoes" class="btn-glass btn-green"><i class="fas fa-save"></i> Salvar Cota√ß√£o</button>
      </div>
    </section>

    <!-- SE√á√ÉO: COTA√á√ïES SALVAS -->
    <section id="sectionCotacoesSalvas" class="glass-panel hidden">
      <div class="panel-header-actions">
        <h3>Hist√≥rico de Cota√ß√µes</h3>
        <div class="filtros-inline">
            <input type="text" id="searchQuotation" placeholder="Buscar cota√ß√£o..." class="glass-input">
            <select id="filterStatus" class="glass-input">
                <option value="Todas">Todas</option>
                <option value="Pendente">Pendente</option>
                <option value="Aprovada">Aprovada</option>
                <option value="Recebido">Recebido</option>
            </select>
            <button id="btnSearchQuotation" class="btn-glass btn-blue"><i class="fas fa-search"></i></button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="glass-table compact-table data-grid">
            <thead>
                <tr>
                    <th data-field="codigo_cotacao">C√ìDIGO <i class="fas fa-sort"></i></th>
                    <th data-field="updated_at">DATA <i class="fas fa-sort"></i></th>
                    <th data-field="usuario">USU√ÅRIO <i class="fas fa-sort"></i></th>
                    <th>VENCEDOR</th>
                    <th data-field="valor_total_vencedor">VALOR <i class="fas fa-sort"></i></th>
                    <th data-field="nota_fiscal">NF <i class="fas fa-sort"></i></th>
                    <th data-field="data_recebimento">DATA REC. <i class="fas fa-sort"></i></th>
                    <th data-field="usuario_recebimento">USU√ÅRIO REC. <i class="fas fa-sort"></i></th>
                    <th data-field="status">STATUS <i class="fas fa-sort"></i></th>
                    <th>A√á√ïES</th>
                </tr>
            </thead>
            <tbody id="savedQuotationsTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- SE√á√ÉO: PRODUTOS -->
    <section id="sectionCadastrarProdutos" class="glass-panel hidden">
      <div class="panel-header-actions">
        <h3>Cadastro de Produtos</h3>
        <div class="acoes-grid-header">
            <button id="btnOpenImportExportModal" class="btn-glass btn-orange"><i class="fas fa-file-import"></i> Importar/Exportar</button>
        </div>
      </div>
      <form id="formCadastrarProduto" class="form-grid" style="grid-template-columns: 1fr 1fr 2fr 1fr auto;">
        <input type="text" id="produtoCodigo1" placeholder="C√≥d. Principal" class="glass-input">
        <input type="text" id="produtoCodigo2" placeholder="C√≥d. Secund√°rio" class="glass-input">
        <input type="text" id="produtoNome" placeholder="Nome do Produto" required class="glass-input">
        <input type="text" id="produtoUnidade" placeholder="UN (KG, LT...)" class="glass-input">
        <button type="submit" id="btnSubmitProduto" class="btn-glass btn-green">Cadastrar</button>
      </form>
      
      <div class="form-group" style="margin-top: 15px;">
        <input type="text" id="searchProdutoInput" placeholder="üîç Buscar produto..." class="glass-input">
      </div>

      <div class="table-responsive produtos-table-container">
        <table class="glass-table data-grid">
            <thead>
                <tr>
                    <th data-field="codigo_principal">C√ìDIGO</th>
                    <th data-field="codigo_secundario">C√ìD. SEC.</th>
                    <th data-field="nome">NOME <i class="fas fa-sort"></i></th>
                    <th data-field="unidade_medida">UN</th>
                    <th>A√á√ïES</th>
                </tr>
            </thead>
            <tbody id="produtosTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- SE√á√ÉO: FORNECEDORES -->
    <section id="sectionCadastrarFornecedor" class="glass-panel hidden">
      <div class="panel-header-actions">
        <h3>Cadastro de Fornecedores</h3>
        <div class="acoes-grid-header">
            <button id="btnOpenImportExportFornecedor" class="btn-glass btn-orange"><i class="fas fa-file-import"></i> Importar/Exportar</button>
        </div>
      </div>
      <form id="formCadastrarFornecedor" class="form-grid" style="grid-template-columns: 2fr 1fr auto;">
        <input type="text" id="fornecedorNome" placeholder="Nome do Fornecedor" required class="glass-input">
        <input type="text" id="fornecedorTelefone" placeholder="Telefone" class="glass-input">
        <button type="submit" id="btnSubmitFornecedor" class="btn-glass btn-green">Cadastrar</button>
      </form>

      <div class="form-group" style="margin-top: 15px;">
        <input type="text" id="searchFornecedorInput" placeholder="üîç Buscar fornecedor..." class="glass-input">
      </div>

      <div class="table-responsive fornecedores-table-container">
        <table class="glass-table data-grid">
            <thead>
                <tr>
                    <th data-field="nome">NOME <i class="fas fa-sort"></i></th>
                    <th data-field="telefone">TELEFONE</th>
                    <th>A√á√ïES</th>
                </tr>
            </thead>
            <tbody id="fornecedoresTableBody"></tbody>
        </table>
      </div>
    </section>

  </main>

  <!-- Pain√©is Flutuantes (Modais) -->
  
  <!-- Import/Export Panel -->
  <div id="importPanel" class="import-panel hidden">
    <div class="panel-header">
        <h3>Importar/Exportar</h3>
        <button class="close-button">&times;</button>
    </div>
    <div class="panel-body">
        <div class="upload-section">
            <label>Importar Excel (.xlsx)</label>
            <input type="file" id="importExcelFile" accept=".xlsx" class="glass-input">
            <div id="importStatus" class="import-status"></div>
            <div id="importPreview" class="import-preview"></div>
            <button id="btnImportProducts" class="btn-glass btn-blue" style="width:100%; margin-top:10px;">Visualizar</button>
            <button id="btnConfirmImport" class="btn-glass btn-green" style="width:100%; margin-top:5px;">Confirmar Importa√ß√£o</button>
        </div>
        <hr>
        <button id="btnExportProducts" class="btn-glass btn-orange" style="width:100%;">Baixar Modelo / Exportar</button>
    </div>
  </div>

  <!-- Detalhes Cota√ß√£o -->
  <div id="detailPanelBackdrop" class="modal-backdrop hidden">
    <div id="detailPanel" class="glass-modal" style="max-width: 800px;">
        <div class="modal-header">
            <h3 id="quotationDetailTitle">Detalhes</h3>
            <button class="close-button">&times;</button>
        </div>
        <div id="quotationDetailBody" class="modal-body"></div>
        <div class="modal-footer" style="margin-top: 15px; text-align: right;">
            <button id="btnPrintQuotation" class="btn-glass btn-blue"><i class="fas fa-print"></i> Imprimir</button>
            <button id="btnGeneratePdf" class="btn-glass btn-red"><i class="fas fa-file-pdf"></i> PDF</button>
        </div>
    </div>
  </div>

  <!-- Painel Recebimento -->
  <div id="recebimentoPanelBackdrop" class="modal-backdrop hidden">
    <div id="recebimentoPanel" class="glass-modal" style="max-width: 700px;">
        <div class="modal-header">
            <h3 id="recebimentoPanelTitle">Recebimento</h3>
            <button class="close-button">&times;</button>
        </div>
        <div class="modal-body">
            <div id="nfContainer">
                <div class="form-group">
                    <label>Nota Fiscal:</label>
                    <input type="text" class="nota-fiscal-input glass-input" placeholder="Digite o n√∫mero da NF">
                </div>
            </div>
            <button id="btnAddNF" class="btn-glass btn-sm btn-blue" style="margin-bottom: 15px;">+ Add NF</button>
            
            <div id="recebimentoItems" class="recebimento-items-container"></div>
        </div>
        <div class="modal-footer" style="margin-top: 15px; text-align: right;">
            <button id="btnSalvarRecebimento" class="btn-glass btn-green">Salvar Recebimento</button>
        </div>
    </div>
  </div>

  <!-- ü¶∂ Rodap√© -->
  <footer class="footer">
    &copy; 2025 Marquespan. Todos os direitos reservados.
  </footer>

  <!-- üöÄ Scripts -->
  <script type="module" src="./script/menu.js"></script>
  <script type="module" src="./script/compras.js"></script>
</body>
</html>