<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consumo de Pneus - Marquespan</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="css/pneu.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <link rel="icon" href="logo.png" type="image/png">
  <style>
    /* Estilos aprimorados para botões e campos */
    .btn-pneu {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: white;
    }
    .btn-pneu:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-pneu:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-add-item { background: linear-gradient(135deg, #28a745 0%, #218838 100%); }
    .btn-add-item:hover { background: linear-gradient(135deg, #34ce57 0%, #28a745 100%); }

    .btn-pneu-save { background: linear-gradient(135deg, #007bff 0%, #0069d9 100%); }
    .btn-pneu-save:hover { background: linear-gradient(135deg, #3395ff 0%, #007bff 100%); }

    .btn-pneu-cancel { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
    .btn-pneu-cancel:hover { background: linear-gradient(135deg, #ff4d5a 0%, #dc3545 100%); }

    .btn-buscar { background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); }
    .btn-buscar:hover { background: linear-gradient(135deg, #1fc8db 0%, #17a2b8 100%); }

    /* Estilização dos campos de formulário */
    .form-group-pneu input,
    .form-group-pneu select,
    .form-group-pneu textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 1rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        background-color: #fff;
    }

    .form-group-pneu input:focus,
    .form-group-pneu select:focus,
    .form-group-pneu textarea:focus {
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .form-group-pneu label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 5px;
        display: block;
    }
    
    /* Ajuste para o grid de instalação múltipla */
    .instalacao-grid-row {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 10px;
        align-items: center;
        margin-bottom: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e9ecef;
    }

    /* Centralizar e limitar largura do formulário */
    #formConsumoPneu {
        max-width: 800px;
        margin: 0 auto;
    }

    #formConsumoPneu .form-group-pneu {
        margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="menu-container">
      <!-- O menu será injetado aqui pelo menu.js -->
    </div>
    <div class="main-content">
      <header class="page-title-header"><i class="fas fa-cogs"></i><span class="page-title-text">Consumo e Movimentação de Pneus</span></header>
      <section class="content-section">
        <!-- Card do Formulário de Movimentação -->
        <div class="form-card">
          <div class="form-header">
            <h3><i class="fas fa-arrow-right"></i>Aplicar ou Movimentar Pneu do Estoque</h3>
          </div>
          <form id="formConsumoPneu">
            <input type="hidden" name="user_id" id="user_id"> <!-- Campo oculto para o ID do usuário -->
            <div class="form-group-pneu"><label for="data">Data</label><input type="datetime-local" name="data" id="data" readonly /></div>
            <div class="form-group-pneu"><label for="tipo_operacao">Tipo de Operação *</label><select name="tipo_operacao" id="tipo_operacao" required><option value="">Selecione</option><option value="INSTALACAO">Instalação Múltipla</option><option value="RODIZIO">Rodízio</option><option value="TROCA">Troca</option><option value="REFORMA">Envio para Reforma</option><option value="DESCARTE">Descarte</option></select></div>
            <div class="form-group-pneu"><label for="placa">Placa do Veículo *</label><select name="placa" id="placa" required><option value="">Selecione</option></select></div>
            <div class="form-group-pneu"><label for="quilometragem">Quilometragem do Veículo *</label><input type="number" name="quilometragem" id="quilometragem" min="0" placeholder="Ex: 150000" required /></div>
            
            <!-- Container para campos que variam por operação -->
            <div id="operacao-detalhes-container">

              <!-- Campos para operações de pneu único (Rodízio, Troca, etc.) -->
              <div id="campos-pneu-unico" class="hidden">
                <div class="form-group-pneu">
                  <label for="codigo_marca_fogo_select">Marca de Fogo *</label>
                  <select name="codigo_marca_fogo" id="codigo_marca_fogo_select"></select>
                </div>
                <div class="form-group-pneu"><label for="aplicacao">Posição de Aplicação *</label><select name="aplicacao" id="aplicacao"><option value="">Selecione</option><option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option><option value="DIANTEIRO_DIREITO">Dianteiro Direito</option><option value="TRACAO_ESQUERDO_INTERNO">Tração Esq. Interno</option><option value="TRACAO_ESQUERDO_EXTERNO">Tração Esq. Externo</option><option value="TRACAO_DIREITO_INTERNO">Tração Dir. Interno</option><option value="TRACAO_DIREITO_EXTERNO">Tração Dir. Externo</option><option value="TRUCK_ESQUERDO_INTERNO">Truck Esq. Interno</option><option value="TRUCK_ESQUERDO_EXTERNO">Truck Esq. Externo</option><option value="TRUCK_DIREITO_INTERNO">Truck Dir. Interno</option><option value="TRUCK_DIREITO_EXTERNO">Truck Dir. Externo</option><option value="ESTEPE">Estepe</option></select></div>
                
                <!-- Detalhes específicos para rodízio/troca -->
                <div id="campos-troca-rodizio" class="saida-details hidden">
                  <h4><i class="fas fa-sync-alt"></i>Detalhes da Troca/Rodízio</h4>
                  <div class="form-group-pneu"><label for="posicao_nova">Nova Posição do Pneu</label><select name="posicao_nova" id="posicao_nova"><option value="">Selecione a nova posição</option><option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option><option value="DIANTEIRO_DIREITO">Dianteiro Direito</option><option value="TRACAO_ESQUERDO_INTERNO">Tração Esq. Interno</option><option value="TRACAO_ESQUERDO_EXTERNO">Tração Esq. Externo</option><option value="TRACAO_DIREITO_INTERNO">Tração Dir. Interno</option><option value="TRACAO_DIREITO_EXTERNO">Tração Dir. Externo</option><option value="TRUCK_ESQUERDO_INTERNO">Truck Esq. Interno</option><option value="TRUCK_ESQUERDO_EXTERNO">Truck Esq. Externo</option><option value="TRUCK_DIREITO_INTERNO">Truck Dir. Interno</option><option value="TRUCK_DIREITO_EXTERNO">Truck Dir. Externo</option><option value="ESTEPE">Estepe</option></select></div>
                  <div class="form-group-pneu"><label for="codigo_marca_fogo_trocado">Marca de Fogo (Pneu Trocado)</label><input type="text" name="codigo_marca_fogo_trocado" id="codigo_marca_fogo_trocado" placeholder="Marca de Fogo do pneu que entra no lugar" /></div>
                </div>
              </div>

              <!-- Grid para Instalação Múltipla -->
              <div id="campos-instalacao-multipla" class="hidden">
                <div class="form-header">
                  <h4><i class="fas fa-truck-loading"></i>Pneus a Instalar</h4>
                  <button type="button" id="btn-adicionar-pneu" class="btn-pneu btn-add-item"><i class="fas fa-plus"></i>Adicionar Pneu</button>
                </div>
                <div id="grid-instalacao-pneus" class="instalacao-grid-container">
                  <!-- Linhas de pneu serão adicionadas aqui pelo JavaScript -->
                </div>
              </div>
            </div>

            <div class="form-group-pneu form-group-full-width"><label for="observacoes">Observações</label><textarea name="observacoes" id="observacoes" rows="3" placeholder="Observações adicionais sobre a movimentação..."></textarea></div>

            <div class="form-actions-pneu">
              <button type="submit" class="btn-pneu btn-pneu-save"><i class="fas fa-check-circle"></i>Confirmar Movimentação</button>
              <button type="button" id="btnCancelForm" class="btn-pneu btn-pneu-cancel"><i class="fas fa-times"></i>Cancelar</button>
            </div>
          </form>
        </div>

        <!-- Card da Tabela de Movimentações -->
        <div class="table-card">
          <div class="form-header">
            <h3><i class="fas fa-list"></i>Últimas Movimentações</h3>
          </div>
          <div class="filtros-pneus">
            <div class="form-group-pneu"><label for="campo-marca-fogo-busca">Marca de Fogo</label><input type="text" id="campo-marca-fogo-busca" placeholder="Digite a marca de fogo" /></div>
            <div class="form-group-pneu"><label for="campo-placa-busca">Placa</label><input type="text" id="campo-placa-busca" placeholder="Digite a placa" /></div>
            <div class="form-group-pneu">
              <label for="campo-operacao">Operação</label>
              <select id="campo-operacao">
                <option value="">Todas</option>
                <option value="INSTALACAO">Instalação Múltipla</option>
                <option value="RODIZIO">Rodízio</option>
                <option value="TROCA">Troca</option>
                <option value="REFORMA">Reforma</option>
                <option value="DESCARTE">Descarte</option>
              </select>
            </div>
            <div class="form-group-pneu filter-actions">
              <button type="button" id="btn-buscar" class="btn-pneu btn-buscar"><i class="fas fa-search"></i>Buscar</button>
              <button type="button" id="btn-limpar-busca" class="btn-pneu btn-pneu-cancel"><i class="fas fa-eraser"></i>Limpar</button>
            </div>
          </div>

          <div class="table-scroll-container">
            <table class="data-grid">
              <thead>
                <tr>
                  <th><i class="fas fa-calendar"></i> Data</th>
                  <th><i class="fas fa-fire"></i> Marca Fogo</th>
                  <th><i class="fas fa-cogs"></i> Operação</th>
                  <th><i class="fas fa-car"></i> Placa</th>
                  <th><i class="fas fa-tachometer-alt"></i> KM Veículo</th>
                  <th><i class="fas fa-map-marker-alt"></i> Posição</th>
                  <th><i class="fas fa-user"></i> Usuário</th>
                  <th><i class="fas fa-tools"></i> Ações</th>
                </tr>
              </thead>
              <tbody id="grid-consumo-pneus-body">
                <!-- Conteúdo gerado pelo JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </div>

  <footer class="footer">
    © 2025 Marquespan. Todos os direitos reservados.
  </footer>

  <script type="module" src="./script/menu.js" defer></script>
  <!-- O script pneu-updated.js precisará ser ajustado para esta nova estrutura -->
  <script type="module" src="./script/pneu-consumo.js" defer></script>
</body>
</html>