<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consumo de Pneus - Marquespan</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="css/pneu.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <link rel="icon" href="logo.png" type="image/png">
</head>
<body>
  <div class="container">
    <div id="menu-container">
      <!-- O menu será injetado aqui pelo menu.js -->
    </div>
    <div class="main-content">
      <header class="page-title-header"><i class="fas fa-cogs"></i><span class="page-title-text">Consumo e Movimentação de Pneus</span></header>
      <section class="content-section">
        <!-- Card do Formulário de Movimentação -->
        <div class="form-card">
          <div class="form-header">
            <h3><i class="fas fa-arrow-right"></i>Aplicar ou Movimentar Pneu do Estoque</h3>
          </div>
          <form id="formConsumoPneu">
            <div class="form-group-pneu"><label for="data">Data</label><input type="datetime-local" name="data" id="data" readonly /></div>
            <div class="form-group-pneu"><label for="tipo_operacao">Tipo de Operação *</label><select name="tipo_operacao" id="tipo_operacao" required><option value="">Selecione</option><option value="INSTALACAO">Instalação Múltipla</option><option value="RODIZIO">Rodízio</option><option value="TROCA">Troca</option><option value="REFORMA">Envio para Reforma</option><option value="DESCARTE">Descarte</option></select></div>
            <div class="form-group-pneu"><label for="placa">Placa do Veículo *</label><select name="placa" id="placa" required><option value="">Selecione</option></select></div>
            <div class="form-group-pneu"><label for="quilometragem">Quilometragem do Veículo *</label><input type="number" name="quilometragem" id="quilometragem" min="0" placeholder="Ex: 150000" required /></div>
            
            <!-- Container para campos que variam por operação -->
            <div id="operacao-detalhes-container">

              <!-- Campos para operações de pneu único (Rodízio, Troca, etc.) -->
              <div id="campos-pneu-unico" class="hidden">
                <div class="form-group-pneu">
                  <label for="codigo_marca_fogo_select">Marca de Fogo *</label>
                  <select name="codigo_marca_fogo" id="codigo_marca_fogo_select" required></select>
                </div>
                <div class="form-group-pneu"><label for="aplicacao">Posição de Aplicação *</label><select name="aplicacao" id="aplicacao"><option value="">Selecione</option><option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option><option value="DIANTEIRO_DIREITO">Dianteiro Direito</option><option value="TRACAO_ESQUERDO_INTERNO">Tração Esq. Interno</option><option value="TRACAO_ESQUERDO_EXTERNO">Tração Esq. Externo</option><option value="TRACAO_DIREITO_INTERNO">Tração Dir. Interno</option><option value="TRACAO_DIREITO_EXTERNO">Tração Dir. Externo</option><option value="TRUCK_ESQUERDO_INTERNO">Truck Esq. Interno</option><option value="TRUCK_ESQUERDO_EXTERNO">Truck Esq. Externo</option><option value="TRUCK_DIREITO_INTERNO">Truck Dir. Interno</option><option value="TRUCK_DIREITO_EXTERNO">Truck Dir. Externo</option><option value="ESTEPE">Estepe</option></select></div>
                
                <!-- Detalhes específicos para rodízio/troca -->
                <div id="campos-troca-rodizio" class="saida-details hidden">
                  <h4><i class="fas fa-sync-alt"></i>Detalhes da Troca/Rodízio</h4>
                  <div class="form-group-pneu"><label for="posicao_nova">Nova Posição do Pneu</label><select name="posicao_nova" id="posicao_nova"><option value="">Selecione a nova posição</option><option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option><option value="DIANTEIRO_DIREITO">Dianteiro Direito</option><option value="TRACAO_ESQUERDO_INTERNO">Tração Esq. Interno</option><option value="TRACAO_ESQUERDO_EXTERNO">Tração Esq. Externo</option><option value="TRACAO_DIREITO_INTERNO">Tração Dir. Interno</option><option value="TRACAO_DIREITO_EXTERNO">Tração Dir. Externo</option><option value="TRUCK_ESQUERDO_INTERNO">Truck Esq. Interno</option><option value="TRUCK_ESQUERDO_EXTERNO">Truck Esq. Externo</option><option value="TRUCK_DIREITO_INTERNO">Truck Dir. Interno</option><option value="TRUCK_DIREITO_EXTERNO">Truck Dir. Externo</option><option value="ESTEPE">Estepe</option></select></div>
                  <div class="form-group-pneu"><label for="codigo_marca_fogo_trocado">Marca de Fogo (Pneu Trocado)</label><input type="text" name="codigo_marca_fogo_trocado" id="codigo_marca_fogo_trocado" placeholder="Marca de Fogo do pneu que entra no lugar" /></div>
                </div>
              </div>

              <!-- Grid para Instalação Múltipla -->
              <div id="campos-instalacao-multipla" class="hidden">
                <div class="form-header">
                  <h4><i class="fas fa-truck-loading"></i>Pneus a Instalar</h4>
                  <button type="button" id="btn-adicionar-pneu" class="btn-pneu btn-add-item"><i class="fas fa-plus"></i>Adicionar Pneu</button>
                </div>
                <div id="grid-instalacao-pneus" class="instalacao-grid-container">
                  <!-- Linhas de pneu serão adicionadas aqui pelo JavaScript -->
                </div>
              </div>
            </div>

            <div class="form-group-pneu form-group-full-width"><label for="observacoes">Observações</label><textarea name="observacoes" id="observacoes" rows="3" placeholder="Observações adicionais sobre a movimentação..."></textarea></div>

            <div class="form-actions-pneu">
              <button type="submit" class="btn-pneu btn-pneu-save"><i class="fas fa-check-circle"></i>Confirmar Movimentação</button>
              <button type="button" id="btnCancelForm" class="btn-pneu btn-pneu-cancel"><i class="fas fa-times"></i>Cancelar</button>
            </div>
          </form>
        </div>

        <!-- Card da Tabela de Movimentações -->
        <div class="table-card">
          <div class="form-header">
            <h3><i class="fas fa-list"></i>Últimas Movimentações</h3>
          </div>
          <div class="filtros-pneus">
            <div class="form-group-pneu"><label for="campo-marca-fogo-busca">Marca de Fogo</label><input type="text" id="campo-marca-fogo-busca" placeholder="Digite a marca de fogo" /></div>
            <div class="form-group-pneu"><label for="campo-placa-busca">Placa</label><input type="text" id="campo-placa-busca" placeholder="Digite a placa" /></div>
            <div class="form-group-pneu">
              <label for="campo-operacao">Operação</label>
              <select id="campo-operacao">
                <option value="">Todas</option>
                <option value="INSTALACAO">Instalação Múltipla</option>
                <option value="RODIZIO">Rodízio</option>
                <option value="TROCA">Troca</option>
                <option value="REFORMA">Reforma</option>
                <option value="DESCARTE">Descarte</option>
              </select>
            </div>
            <div class="form-group-pneu filter-actions">
              <button type="button" id="btn-buscar" class="btn-pneu btn-buscar"><i class="fas fa-search"></i>Buscar</button>
              <button type="button" id="btn-limpar-busca" class="btn-pneu btn-pneu-cancel"><i class="fas fa-eraser"></i>Limpar</button>
            </div>
          </div>

          <div class="table-scroll-container">
            <table class="data-grid">
              <thead>
                <tr>
                  <th><i class="fas fa-calendar"></i> Data</th>
                  <th><i class="fas fa-fire"></i> Marca Fogo</th>
                  <th><i class="fas fa-cogs"></i> Operação</th>
                  <th><i class="fas fa-car"></i> Placa</th>
                  <th><i class="fas fa-tachometer-alt"></i> KM Veículo</th>
                  <th><i class="fas fa-map-marker-alt"></i> Posição</th>
                  <th><i class="fas fa-user"></i> Usuário</th>
                  <th><i class="fas fa-tools"></i> Ações</th>
                </tr>
              </thead>
              <tbody id="grid-consumo-pneus-body">
                <!-- Conteúdo gerado pelo JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </div>

  <footer class="footer">
    © 2025 Marquespan. Todos os direitos reservados.
  </footer>

  <script type="module" src="./script/menu.js" defer></script>
  <!-- O script pneu-updated.js precisará ser ajustado para esta nova estrutura -->
  <script type="module" src="./script/pneu-consumo.js" defer></script>
</body>
</html>