<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coletar Manuten√ß√£o - Marquespan</title>
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/coletar-manutencao.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

  <!-- Container para inje√ß√£o do Menu Lateral -->
  <div id="menu-container"></div>

  <!-- üß± Conte√∫do principal -->
  <main class="main-content">
    <header class="header glass-header" style="display: flex; justify-content: space-between; align-items: center;">
      <h1><i class="fas fa-tools"></i> Coleta de Manuten√ß√£o</h1>
      <button id="btnModoApp" class="btn-glass btn-blue" onclick="window.location.href='mobile-coletar.html'"><i class="fas fa-mobile-alt"></i> MODO APP</button>
    </header>

    <!-- Navega√ß√£o por Abas -->
    <div class="painel-navegacao" id="menu-coletar-manutencao">
      <button class="painel-btn active" data-secao="sectionLancamento"><i class="fas fa-list"></i> Lan√ßamentos</button>
      <button class="painel-btn" data-secao="sectionGerarArquivo"><i class="fas fa-file-alt"></i> Relat√≥rios e Gr√°ficos</button>
    </div>

    <!-- SE√á√ÉO: LAN√áAMENTOS -->
    <section id="sectionLancamento" class="glass-panel">
      <h3><i class="fas fa-clipboard-list"></i> Manuten√ß√µes Lan√ßadas</h3>
      
      <div class="lancamentos-layout">
        <!-- Card de Filtros -->
        <div class="glass-panel-inner">
            <h4><i class="fas fa-filter"></i> Filtros</h4>
            <div class="filtros-container">
                <div class="form-group-filter">
                    <label>Placa</label>
                    <input type="text" id="searchPlaca" placeholder="Buscar Placa..." class="glass-input">
                </div>
                <div class="form-group-filter">
                    <label>Item</label>
                    <select id="searchItem" class="glass-input">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="form-group-filter">
                    <label>Oficina</label>
                    <select id="searchOficina" class="glass-input">
                        <option value="">Todas</option>
                    </select>
                </div>
                <div class="form-group-filter">
                    <label>Status</label>
                    <select id="searchStatus" class="glass-input">
                        <option value="">Todos</option>
                        <option value="PENDENTE">PENDENTE</option>
                        <option value="FINALIZADO">FINALIZADO</option>
                        <option value="INTERNADO">INTERNADO</option>
                        <option value="CHECK-IN OFICINA">CHECK-IN OFICINA</option>
                        <option value="CHECK-IN ROTA">CHECK-IN ROTA</option>
                        <option value="FINALIZADO ROTA">FINALIZADO ROTA</option>
                    </select>
                </div>
                <div class="form-group-filter" style="align-self: flex-end;">
                    <button id="btnFiltrarLancamentos" class="btn-glass btn-blue" style="width: 100%;"><i class="fas fa-search"></i> Filtrar</button>
                </div>
            </div>
        </div>

        <!-- Card de A√ß√µes -->
        <div class="glass-panel-inner actions-panel">
            <h4><i class="fas fa-cogs"></i> A√ß√µes</h4>
            <div class="acoes-grid-vertical">
                <button id="btnAdicionarLancamento" class="btn-glass btn-green"><i class="fas fa-plus"></i> Novo Lan√ßamento</button>
                <button id="btnImportarMassa" class="btn-glass btn-orange"><i class="fas fa-file-import"></i> Importar XLSX</button>
            </div>
        </div>
      </div>

      <!-- Legenda de Cores -->
      <div class="status-legend-container">
        <span class="legend-item"><span class="legend-color" style="background-color: #d4edda; border-color: #155724;"></span> FINALIZADO</span>
        <span class="legend-item"><span class="legend-color" style="background-color: #f8d7da; border-color: #721c24;"></span> PENDENTE</span>
        <span class="legend-item"><span class="legend-color" style="background-color: #cce5ff; border-color: #004085;"></span> INTERNADO</span>
        <span class="legend-item"><span class="legend-color" style="background-color: #fff3cd; border-color: #856404;"></span> CHECK-IN OFICINA</span>
        <span class="legend-item"><span class="legend-color" style="background-color: #ffe0b2; border-color: #d35400;"></span> CHECK-IN ROTA</span>
        <span class="legend-item"><span class="legend-color" style="background-color: #d4edda; border-color: #0b3314; font-weight: bold;"></span> FINALIZADO ROTA</span>
      </div>

      <!-- Tabela -->
      <div class="table-responsive manutencao-table-container">
        <table class="glass-table data-grid">
          <thead>
            <tr>
              <th data-sort="data_hora">DATA/HORA <i class="fas fa-sort"></i></th>
              <th data-sort="semana">SEMANA <i class="fas fa-sort"></i></th>
              <th data-sort="placa">PLACA <i class="fas fa-sort"></i></th>
              <th data-sort="usuario">USU√ÅRIO <i class="fas fa-sort"></i></th>
              <th>VALOR TOTAL</th>
              <th>A√á√ïES</th>
            </tr>
          </thead>
          <tbody id="tableBodyLancamentos">
            <!-- Preenchido via JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- SE√á√ÉO: RELAT√ìRIOS -->
    <section id="sectionGerarArquivo" class="glass-panel hidden">
      <h3><i class="fas fa-chart-bar"></i> Relat√≥rios e An√°lises</h3>
      
      <form id="formExportacao">
        <div class="lancamentos-layout">
            <!-- Card de Filtros -->
            <div class="glass-panel-inner">
                <h4><i class="fas fa-filter"></i> Filtros</h4>
                <div class="filtros-container">
                    <div class="form-group-filter">
                        <label>Semana</label>
                        <input type="text" id="filtroSemana" placeholder="Ex: 01" class="glass-input">
                    </div>
                    <div class="form-group-filter">
                        <label>Placa</label>
                        <input type="text" id="filtroPlaca" placeholder="Ex: ABC1234" class="glass-input">
                    </div>
                    <div class="form-group-filter">
                        <label>Data In√≠cio</label>
                        <input type="date" id="filtroDataIni" class="glass-input">
                    </div>
                    <div class="form-group-filter">
                        <label>Data Fim</label>
                        <input type="date" id="filtroDataFim" class="glass-input">
                    </div>
                </div>

                <!-- Filtros Avan√ßados (Multiselect) -->
                <div class="filtros-avancados-grid">
                    <!-- Item -->
                    <div class="custom-multiselect">
                        <label>Itens</label>
                        <div id="filtroItemDisplay" class="glass-input multiselect-display">
                            <span id="filtroItemText">Todos</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div id="filtroItemOptions" class="glass-dropdown hidden">
                            <div class="dropdown-header"><button type="button" id="btnLimparSelecaoItem">Limpar</button></div>
                            <!-- Op√ß√µes via JS -->
                        </div>
                    </div>

                    <!-- Oficina -->
                    <div class="custom-multiselect">
                        <label>Oficinas</label>
                        <div id="filtroOficinaDisplay" class="glass-input multiselect-display">
                            <span id="filtroOficinaText">Todas</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div id="filtroOficinaOptions" class="glass-dropdown hidden">
                            <div class="dropdown-header"><button type="button" id="btnLimparSelecaoOficina">Limpar</button></div>
                            <!-- Op√ß√µes via JS -->
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="custom-multiselect">
                        <label>Status</label>
                        <div id="filtroStatusDisplay" class="glass-input multiselect-display">
                            <span id="filtroStatusText">Todos</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div id="filtroStatusOptions" class="glass-dropdown hidden">
                            <div class="dropdown-header"><button type="button" id="btnLimparTudo">Limpar</button></div> <!-- Reusing ID for simplicity or create new -->
                            <label class="dropdown-item" style="background-color: #f8d7da; color: #721c24;"><input type="checkbox" class="filtro-status-checkbox" value="PENDENTE"> PENDENTE</label>
                            <label class="dropdown-item" style="background-color: #d4edda; color: #155724;"><input type="checkbox" class="filtro-status-checkbox" value="FINALIZADO"> FINALIZADO</label>
                            <label class="dropdown-item" style="background-color: #cce5ff; color: #004085;"><input type="checkbox" class="filtro-status-checkbox" value="INTERNADO"> INTERNADO</label>
                            <label class="dropdown-item" style="background-color: #fff3cd; color: #856404;"><input type="checkbox" class="filtro-status-checkbox" value="CHECK-IN OFICINA"> CHECK-IN OFICINA</label>
                            <label class="dropdown-item" style="background-color: #ffe0b2; color: #d35400;"><input type="checkbox" class="filtro-status-checkbox" value="CHECK-IN ROTA"> CHECK-IN ROTA</label>
                            <label class="dropdown-item" style="background-color: #d4edda; color: #0b3314; font-weight: bold;"><input type="checkbox" class="filtro-status-checkbox" value="FINALIZADO ROTA"> FINALIZADO ROTA</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de A√ß√µes -->
            <div class="glass-panel-inner actions-panel">
                <h4><i class="fas fa-cogs"></i> A√ß√µes</h4>
                <div class="acoes-grid-vertical">
                    <button type="button" id="btnBuscarRelatorio" class="btn-glass btn-blue"><i class="fas fa-search"></i> Buscar Resultados</button>
                    <button type="submit" class="btn-glass btn-green"><i class="fas fa-file-excel"></i> Exportar Excel</button>
                    <button type="button" id="btnExportarPDFServicos" class="btn-glass btn-red"><i class="fas fa-file-pdf"></i> PDF (Servi√ßos)</button>
                    <button type="button" id="btnExportarPDFOficina" class="btn-glass btn-red"><i class="fas fa-file-pdf"></i> PDF (Oficina)</button>
                </div>
            </div>
        </div>
      </form>

      <hr style="margin: 20px 0; border-color: rgba(0,0,0,0.1);">

      <!-- Tabela de Resultados -->
      <div class="panel-header">
        <h3>Resultados da Busca <span id="contadorResultados" style="font-size: 0.8em; color: #666;"></span></h3>
      </div>
      <div class="table-responsive manutencao-table-container">
        <table class="glass-table data-grid">
            <thead>
                <tr>
                    <th data-sort="data_hora">DATA <i class="fas fa-sort"></i></th>
                    <th data-sort="semana">SEM <i class="fas fa-sort"></i></th>
                    <th data-sort="placa">PLACA <i class="fas fa-sort"></i></th>
                    <th data-sort="modelo">MODELO <i class="fas fa-sort"></i></th>
                    <th data-sort="item">ITEM <i class="fas fa-sort"></i></th>
                    <th data-sort="status">STATUS <i class="fas fa-sort"></i></th>
                    <th data-sort="oficina">OFICINA <i class="fas fa-sort"></i></th>
                    <th>DETALHES</th>
                    <th>PE√áAS</th>
                    <th>VALOR</th>
                    <th>A√á√ïES</th>
                </tr>
            </thead>
            <tbody id="tableBodyRelatorio"></tbody>
        </table>
      </div>

      <!-- Gr√°ficos (Movido para baixo da tabela) -->
      <div id="graficos-container" style="display: none; margin-top: 30px;">
        <div class="graficos-grid">
            <div class="grafico-card glass-panel">
                <h4>Status das Manuten√ß√µes</h4>
                <div class="chart-wrapper"><canvas id="grafico-status"></canvas></div>
            </div>
            <div class="grafico-card glass-panel">
                <h4>Top Itens/Servi√ßos</h4>
                <div class="chart-wrapper"><canvas id="grafico-itens"></canvas></div>
            </div>
            <div class="grafico-card glass-panel">
                <h4>Manuten√ß√µes por Oficina</h4>
                <div class="chart-wrapper"><canvas id="grafico-oficinas"></canvas></div>
            </div>
        </div>
      </div>
    </section>

  </main>

  <!-- ü¶∂ Rodap√© -->
  <footer class="footer">
    &copy; 2025 Marquespan. Todos os direitos reservados.
  </footer>

  <!-- MODAL LAN√áAMENTO -->
  <div id="modalLancamento" class="modal-backdrop hidden">
    <div class="glass-modal" style="max-width: 900px;">
        <div class="modal-header">
            <h3><i class="fas fa-edit"></i> Lan√ßamento de Manuten√ß√£o</h3>
            <button class="close-button">&times;</button>
        </div>
        <div class="modal-body">
            <form id="formLancamentoColeta">
                <div class="lancamento-top-grid">
                    <!-- Card 1: Dados Gerais -->
                    <div class="modal-card">
                        <h4><i class="fas fa-info-circle"></i> Dados Gerais</h4>
                        <div class="form-group">
                            <label>Semana</label>
                            <input type="text" id="coletaSemana" class="glass-input" readonly>
                        </div>
                        <div class="form-group">
                            <label>Data/Hora</label>
                            <input type="datetime-local" id="coletaDataHora" class="glass-input" required>
                        </div>
                        <div class="form-group">
                            <label>Usu√°rio</label>
                            <input type="text" id="coletaUsuario" class="glass-input" readonly>
                        </div>
                    </div>

                    <!-- Card 2: Ve√≠culo -->
                    <div class="modal-card">
                        <h4><i class="fas fa-truck"></i> Ve√≠culo</h4>
                        <div class="form-group">
                            <label>Placa</label>
                            <input type="text" id="coletaPlaca" list="veiculosList" class="glass-input" required placeholder="AAA0000">
                            <datalist id="veiculosList"></datalist>
                        </div>
                        <div class="form-group">
                            <label>Modelo</label>
                            <input type="text" id="coletaModelo" class="glass-input" readonly>
                        </div>
                        <div class="form-group">
                            <label>KM</label>
                            <input type="number" id="coletaKm" class="glass-input" placeholder="0">
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label>Valor Total</label>
                    <input type="text" id="coletaValorTotal" class="glass-input" readonly placeholder="R$ 0,00" style="font-weight: bold; color: var(--primary-color);">
                </div>

                <hr style="margin: 15px 0; border-color: rgba(0,0,0,0.1);">
                
                <h4>Checklist de Servi√ßos</h4>
                <div id="checklistContainer" class="checklist-container">
                    <!-- Itens gerados via JS -->
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-glass btn-green"><i class="fas fa-save"></i> Salvar Lan√ßamento</button>
                </div>
            </form>
        </div>
    </div>
  </div>

  <!-- MODAL IMPORTA√á√ÉO -->
  <div id="modalImportacaoMassa" class="modal-backdrop hidden">
    <div class="glass-modal">
        <div class="modal-header">
            <h3><i class="fas fa-file-import"></i> Importa√ß√£o em Massa</h3>
            <button class="close-button">&times;</button>
        </div>
        <div class="modal-body">
            <form id="formImportacaoMassa">
                <div class="form-group">
                    <label>Tipo de Importa√ß√£o</label>
                    <select id="tipoImportacao" class="glass-input">
                        <option value="GERAL">Geral (Padr√£o)</option>
                        <option value="MOLEIRO">Moleiro</option>
                        <option value="MECANICA_EXTERNA">Mec√¢nica Externa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Arquivo Excel (.xlsx)</label>
                    <input type="file" id="arquivoImportacao" accept=".xlsx" class="glass-input" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-glass btn-green"><i class="fas fa-check"></i> Processar Arquivo</button>
                </div>
            </form>
        </div>
    </div>
  </div>

  <!-- Bot√£o Flutuante Mobile -->
  <button id="btnAdicionarItem" class="fab-btn"><i class="fas fa-plus"></i></button>

  <!-- üöÄ Scripts -->
  <script type="module" src="./script/menu.js"></script>
  <script type="module" src="./script/coletar-manutencao.js"></script>
</body>
</html>
