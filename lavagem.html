<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Lavagem - Marquespan</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/lavagem.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <style>
        .badge-agendado { background-color: #ffc107; color: #212529; }
        .badge-realizado { background-color: #28a745; color: white; }
        .badge-pendente { background-color: #dc3545; color: white; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.85em; font-weight: bold; }
    </style>
</head>
<body>
    <div id="menu-container"></div>

    <div class="main-content">
        <header class="glass-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h1><i class="fas fa-shower"></i> Controle de Lavagem</h1>
            <a href="mobile-lavagem.html" class="btn-glass btn-green" style="text-decoration: none; color: white;"><i class="fas fa-mobile-alt"></i> Modo App</a>
        </header>

        <div class="painel-navegacao">
            <button class="painel-btn active" data-tab="tab-listas">Listas de Lavagem</button>
            <button class="painel-btn" data-tab="tab-precificacao">Precificação</button>
            <button class="painel-btn" data-tab="tab-relatorios">Relatórios</button>
        </div>

        <section id="tab-listas" class="glass-panel tab-content">
            <div class="panel-header-actions">
                <h3>Listas de Lavagem</h3>
                <button id="btnNovaLista" class="btn-glass btn-green"><i class="fas fa-plus"></i> Nova Lista</button>
            </div>

            <div class="filtros-container">
                <div class="form-group">
                    <label>Data Início</label>
                    <input type="date" id="filtroDataIni" class="glass-input">
                </div>
                <div class="form-group">
                    <label>Data Fim</label>
                    <input type="date" id="filtroDataFim" class="glass-input">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="filtroStatus" class="glass-input">
                        <option value="">Todos</option>
                        <option value="ABERTA">Aberta</option>
                        <option value="FINALIZADA">Finalizada</option>
                    </select>
                </div>
                <button id="btnBuscar" class="btn-glass btn-blue"><i class="fas fa-search"></i> Buscar</button>
            </div>

            <div class="table-responsive lavagem-table-container">
                <table class="glass-table">
                    <thead>
                        <tr>
                            <th>Data Criação</th>
                            <th>Nome da Lista</th>
                            <th>Data da Lavagem</th>
                            <th>Status</th>
                            <th>Progresso</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyListas">
                        <!-- JS fills this -->
                    </tbody>
                </table>
            </div>
        </section>

        <section id="tab-precificacao" class="glass-panel tab-content hidden">
            <h3><i class="fas fa-tags"></i> Tabela de Preços</h3>
            <div class="filtros-container">
                <div class="form-group">
                    <label>Tipo de Veículo</label>
                    <select id="precoTipoVeiculo" class="glass-input">
                        <option value="">Carregando...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tipo de Lavagem</label>
                    <select id="precoTipoLavagem" class="glass-input">
                        <option value="SIMPLES">SIMPLES</option>
                        <option value="BAÚ COMPLETO">BAÚ COMPLETO</option>
                        <option value="CHASSI">CHASSI</option>
                        <option value="MOTOR">MOTOR</option>
                        <option value="THERMO KING">THERMO KING</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor (R$)</label>
                    <input type="number" id="precoValor" class="glass-input" step="0.01" placeholder="0.00">
                </div>
                <button id="btnSalvarPreco" class="btn-glass btn-green"><i class="fas fa-save"></i> Adicionar</button>
            </div>
            <div class="table-responsive">
                <table class="glass-table">
                    <thead>
                        <tr>
                            <th>Tipo de Veículo</th>
                            <th>Tipo de Lavagem</th>
                            <th>Valor</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyPrecos"></tbody>
                </table>
            </div>
        </section>

        <section id="tab-relatorios" class="glass-panel tab-content hidden">
            <h3><i class="fas fa-chart-line"></i> Relatório de Listas</h3>
            <div class="filtros-container">
                <div class="form-group">
                    <label>Data Início (Lista)</label>
                    <input type="date" id="relDataIni" class="glass-input">
                </div>
                <div class="form-group">
                    <label>Data Fim (Lista)</label>
                    <input type="date" id="relDataFim" class="glass-input">
                </div>
                <button id="btnGerarRelatorio" class="btn-glass btn-blue"><i class="fas fa-search"></i> Buscar</button>
            </div>
            <div class="resumo-lista" style="margin-bottom: 15px; display: flex; gap: 20px; font-weight: bold; font-size: 1.1em;">
                <span style="color: #28a745;">Valor Total Geral: <span id="relTotalGastoGeral">R$ 0,00</span></span>
            </div>
            <div class="table-responsive">
                <table class="glass-table" id="tabelaRelatorio">
                    <thead>
                        <tr>
                            <th>Data Criação</th>
                            <th>Data Lista</th>
                            <th>Qtd Realizada</th>
                            <th>Qtd Pendente</th>
                            <th>Valor</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyRelatorio"></tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Modal Nova Lista -->
    <div id="modalNovaLista" class="modal-backdrop hidden">
        <div class="glass-modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3><i class="fas fa-list"></i> Criar Nova Lista</h3>
                <button class="close-button" id="btnCloseModalNovaLista">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nome da Lista</label>
                        <input type="text" id="nomeNovaLista" class="glass-input" placeholder="Ex: Lavagem Semana 42">
                    </div>
                    <div class="form-group">
                        <label>Data da Lavagem</label>
                        <input type="date" id="dataDaLista" class="glass-input">
                    </div>
                </div>

                <div class="filtros-modal" style="margin: 15px 0; display: flex; gap: 10px;">
                    <input type="text" id="filtroPlacaNovaLista" class="glass-input" placeholder="Filtrar por Placa...">
                    <select id="filtroFilialNovaLista" class="glass-input">
                        <option value="">Todas Filiais</option>
                    </select>
                    <div class="custom-multiselect" style="position: relative; min-width: 180px;">
                        <div id="filtroTipoNovaListaDisplay" class="glass-input" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                            <span id="filtroTipoNovaListaText">Todos os Tipos</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div id="filtroTipoNovaListaOptions" class="glass-dropdown" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ccc; border-radius: 4px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
                    </div>
                </div>

                <div class="table-responsive" style="max-height: 400px;">
                    <table class="glass-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="chkAllNovaLista"></th>
                                <th>Placa</th>
                                <th>Modelo</th>
                                <th>Marca</th>
                                <th>Filial</th>
                                <th>Situação</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyVeiculosAptos">
                            <!-- JS fills this -->
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 10px; text-align: right; font-weight: bold; color: #006937;">
                    <span id="contadorNovaLista">0 selecionado(s)</span>
                </div>
            </div>
            <div class="modal-footer" style="padding-top: 20px; text-align: right;">
                <button id="btnCancelarNovaLista" class="btn-glass btn-red" style="margin-right: 10px;"><i class="fas fa-times"></i> Fechar</button>
                <button id="btnConfirmarCriacao" class="btn-glass btn-green"><i class="fas fa-save"></i> Criar Lista</button>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes -->
    <div id="modalDetalhesLista" class="modal-backdrop hidden">
        <div class="glass-modal" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 id="tituloDetalhesLista">Detalhes da Lista</h3>
                <button class="close-button" id="btnCloseModalDetalhes">&times;</button>
            </div>
            <div class="modal-body">
                <div class="actions-bar" style="margin-bottom: 15px; display: flex; justify-content: space-between;">
                    <input type="text" id="filtroDetalhesInput" class="glass-input" placeholder="Buscar na lista..." style="max-width: 300px;">
                    <div style="display: flex; gap: 10px;">
                        <button id="btnExportarPDF" class="btn-glass btn-red"><i class="fas fa-file-pdf"></i> PDF</button>
                        <button id="btnFinalizarLista" class="btn-glass btn-green"><i class="fas fa-check-double"></i> Finalizar Lista</button>
                    </div>
                </div>

                <div class="bulk-actions" style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; border: 1px solid #e9ecef;">
                    <span style="font-weight: bold; color: #555;">Ações em Massa:</span>
                    <span id="contador-selecionados-detalhes" style="font-size: 0.9em; color: #006937; font-weight: bold;">0 selecionados</span>
                    
                    <div style="display: flex; gap: 5px; align-items: center; border-left: 1px solid #ccc; padding-left: 10px;">
                        <select id="select-bulk-tipo" class="glass-input" style="padding: 5px; height: 32px; font-size: 0.9em;"></select>
                        <button id="btn-bulk-aplicar-tipo" class="btn-glass btn-blue" style="padding: 5px 10px; font-size: 0.85em;">Aplicar Tipo</button>
                    </div>
            
                    <div style="display: flex; gap: 5px; align-items: center; border-left: 1px solid #ccc; padding-left: 10px;">
                        <input type="date" id="dataAgendamentoBulk" class="glass-input" style="padding: 5px; height: 32px; font-size: 0.9em;">
                        <button id="btn-bulk-agendar" class="btn-glass btn-yellow" style="padding: 5px 10px; font-size: 0.85em; color: black;"><i class="fas fa-calendar-alt"></i> Agendar</button>
                    </div>
            
                    <div style="display: flex; gap: 5px; align-items: center; border-left: 1px solid #ccc; padding-left: 10px;">
                        <button id="btn-bulk-realizado" class="btn-glass btn-green" style="padding: 5px 10px; font-size: 0.85em;" title="Marcar como Realizado"><i class="fas fa-check"></i></button>
                        <button id="btn-bulk-pendente" class="btn-glass btn-red" style="padding: 5px 10px; font-size: 0.85em;" title="Marcar como Pendente"><i class="fas fa-undo"></i></button>
                        <button id="btn-bulk-remover" class="btn-glass btn-red" style="padding: 5px 10px; font-size: 0.85em;" title="Remover da Lista"><i class="fas fa-trash"></i></button>
                    </div>
                </div>

                <div class="table-responsive" style="max-height: 500px;">
                    <table class="glass-table">
                        <thead>
                            <tr>
                                <th style="width: 40px; text-align: center;"><input type="checkbox" id="chkAllDetalhes"></th>
                                <th class="sortable" data-sort="placa" style="cursor: pointer;">Placa <i class="fas fa-sort"></i></th>
                                <th class="sortable" data-sort="modelo" style="cursor: pointer;">Modelo <i class="fas fa-sort"></i></th>
                                <th class="sortable" data-sort="marca" style="cursor: pointer;">Marca <i class="fas fa-sort"></i></th>
                                <th class="sortable" data-sort="tipo_lavagem" style="cursor: pointer;">Tipo Lavagem <i class="fas fa-sort"></i></th>
                                <th class="sortable" data-sort="status" style="cursor: pointer;">Status <i class="fas fa-sort"></i></th>
                                <th class="sortable" data-sort="data_realizado" style="cursor: pointer;">Data <i class="fas fa-sort"></i></th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyDetalhesItens">
                            <!-- JS fills this -->
                        </tbody>
                    </table>
                </div>
                <div class="resumo-lista" style="margin-top: 15px; display: flex; gap: 20px; font-weight: bold;">
                    <span style="color: #28a745;">Realizados: <span id="countRealizados">0</span></span>
                    <span style="color: #dc3545;">Pendentes: <span id="countPendentes">0</span></span>
                </div>
            </div>
            <div class="modal-footer" style="padding-top: 20px; text-align: right; border-top: 1px solid #eee; margin-top: 15px;">
                <button id="btnFecharDetalhes" class="btn-glass btn-red"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>

    <script type="module" src="script/menu.js"></script>
    <script type="module" src="script/lavagem.js"></script>
</body>
</html>