<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sa√≠das/Rod√≠zio de Pneus - Marquespan</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

  <main class="main-content">
    <header class="page-title-header"><i class="fas fa-arrow-right page-title-icon"></i><span class="page-title-text">Sa√≠das e Rod√≠zio de Pneus</span></header>
    <section class="content-section">

      <!-- Se√ß√£o de Tipo de Sa√≠da -->
      <div class="form-card" style="background: #fff; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef;">
        <div class="form-header" style="border-bottom: 2px solid #28a745; padding-bottom: 15px; margin-bottom: 20px;">
          <h3 style="color: #28a745; margin: 0; font-size: 1.4rem;"><i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i>Tipo de Sa√≠da</h3>
        </div>
        <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
          <label>Tipo de Sa√≠da *</label>
          <select name="tipo_saida" id="tipo_saida" required style="height: 45px; font-size: 1.1rem;">
            <option value="">Selecione o Tipo</option>
            <option value="VEICULO">Aplica√ß√£o em Ve√≠culo</option>
            <option value="VENDA">Venda</option>
            <option value="DESCARTE">Descarte</option>
            <option value="AJUSTE">Ajuste de Estoque</option>
          </select>
        </div>
      </div>

      <!-- Visualiza√ß√£o das Posi√ß√µes Atuais -->
      <div class="form-card" id="posicoes-card" style="background: #fff; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef; display: none;">
        <div class="form-header" style="border-bottom: 2px solid #17a2b8; padding-bottom: 15px; margin-bottom: 20px;">
          <h3 style="color: #17a2b8; margin: 0; font-size: 1.4rem;"><i class="fas fa-map-marker-alt" style="margin-right: 8px;"></i>Posi√ß√µes Atuais dos Pneus</h3>
        </div>
        <div id="posicoes-veiculo" class="posicoes-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <!-- Posi√ß√µes ser√£o carregadas dinamicamente -->
        </div>
      </div>

      <!-- Card do Formul√°rio de Sa√≠da -->
      <div class="form-card" id="form-card" style="background: #fff; border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef; display: none;">
        <div class="form-header" style="border-bottom: 2px solid #dc3545; padding-bottom: 15px; margin-bottom: 20px;">
          <h3 style="color: #dc3545; margin: 0; font-size: 1.4rem;"><i class="fas fa-arrow-right" style="margin-right: 8px;"></i>Registro de Sa√≠da</h3>
        </div>
        <form id="formSaida">
          <div class="form-bloco">
            <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
              <label>Data da Opera√ß√£o</label>
              <input type="datetime-local" name="data_operacao" id="data_operacao" readonly />

              <label>Quilometragem do Ve√≠culo *</label>
              <input type="number" name="quilometragem" id="quilometragem" min="0" placeholder="Ex: 150000" required />

              <label>Tipo de Opera√ß√£o *</label>
              <select name="tipo_operacao" id="tipo_operacao" required>
                <option value="">Selecione</option>
                <option value="RODIZIO">üîÑ Rod√≠zio</option>
                <option value="INSTALACAO">üì¶ Instala√ß√£o</option>
                <option value="TROCA">üîß Troca</option>
                <option value="DESCARTE">üóëÔ∏è Descarte</option>
                <option value="BORRACHARIA_TERCERIZADA">üè™ Borracharia Tercerizada</option>
              </select>

              <label>Aplica√ß√£o *</label>
              <select name="aplicacao" id="aplicacao" required>
                <option value="">Selecione</option>
                <option value="DIANTEIRO">üöó Dianteiro</option>
                <option value="TRACAO">üöõ Tra√ß√£o</option>
                <option value="TRUCK">üöö Truck</option>
                <option value="ESTOQUE_EXTERNO">üì¶ Estoque Externo</option>
              </select>
            </div>

            <!-- Campos espec√≠ficos para rod√≠zio -->
            <div id="campos-rodizio" style="display: none; margin-top: 25px; background: #fff3cd; padding: 20px; border-radius: 8px; border: 1px solid #ffeaa7;">
              <h4 style="color: #856404; margin-bottom: 15px;"><i class="fas fa-sync-alt" style="margin-right: 8px;"></i>Configura√ß√£o do Rod√≠zio</h4>
              <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">

                <label>Posi√ß√£o Atual do Pneu</label>
                <select name="posicao_anterior" id="posicao_anterior">
                  <option value="">Selecione posi√ß√£o atual</option>
                  <option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option>
                  <option value="DIANTEIRO_DIREITO">Dianteiro Direito</option>
                  <option value="TRACAO_ESQUERDO">Tra√ß√£o Esquerdo</option>
                  <option value="TRACAO_DIREITO">Tra√ß√£o Direito</option>
                  <option value="TRUCK_ESQUERDO">Truck Esquerdo</option>
                  <option value="TRUCK_DIREITO">Truck Direito</option>
                </select>

                <label>Nova Posi√ß√£o</label>
                <select name="posicao_nova" id="posicao_nova">
                  <option value="">Selecione nova posi√ß√£o</option>
                  <option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option>
                  <option value="DIANTEIRO_DIREITO">Dianteiro Direito</option>
                  <option value="TRACAO_ESQUERDO">Tra√ß√£o Esquerdo</option>
                  <option value="TRACAO_DIREITO">Tra√ß√£o Direito</option>
                  <option value="TRUCK_ESQUERDO">Truck Esquerdo</option>
                  <option value="TRUCK_DIREITO">Truck Direito</option>
                </select>

                <label>C√≥digo Marca de Fogo (Pneu a ser removido)</label>
                <input type="text" name="codigo_marca_fogo_trocado" id="codigo_marca_fogo_trocado" placeholder="Ex: MF001" maxlength="10" />

                <label>C√≥digo Marca de Fogo (Pneu a ser instalado)</label>
                <input type="text" name="codigo_marca_fogo_instalado" id="codigo_marca_fogo_instalado" placeholder="Ex: MF002" maxlength="10" />
              </div>
            </div>

            <!-- Sele√ß√£o de Pneu do Estoque -->
            <div style="margin-top: 25px; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
              <h4 style="color: #495057; margin-bottom: 15px;"><i class="fas fa-boxes" style="margin-right: 8px;"></i>Sele√ß√£o do Pneu do Estoque</h4>

              <!-- Filtros para busca -->
              <table style="border: none; border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                <tr>
                  <td style="border: none; padding: 5px;"><label>Filtrar Marca</label></td>
                  <td style="border: none; padding: 5px;">
                    <select name="filtro_marca" id="filtro_marca">
                      <option value="">Todas</option>
                      <option value="BRIDGESTONE">BRIDGESTONE</option>
                      <option value="CONTINENTAL">CONTINENTAL</option>
                      <option value="GOODYEAR">GOODYEAR</option>
                      <option value="MICHELIN">MICHELIN</option>
                      <option value="PIRELLI">PIRELLI</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td style="border: none; padding: 5px;"><label>Filtrar Modelo</label></td>
                  <td style="border: none; padding: 5px;">
                    <select name="filtro_modelo" id="filtro_modelo">
                      <option value="">Todos</option>
                      <option value="225/75/16">225/75/16</option>
                      <option value="235/75/17.5">235/75/17.5</option>
                      <option value="275/80/22.5 - LISO">275/80/22.5 - LISO</option>
                      <option value="275/80/22.5 - BORRACHUDO">275/80/22.5 - BORRACHUDO</option>
                      <option value="295/80/22.5 - LISO">295/80/22.5 - LISO</option>
                      <option value="295/80/22.5 - BORRACHUDO">295/80/22.5 - BORRACHUDO</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td style="border: none; padding: 5px;"><label>Filtrar Tipo</label></td>
                  <td style="border: none; padding: 5px;">
                    <select name="filtro_tipo" id="filtro_tipo">
                      <option value="">Todos</option>
                      <option value="NOVO">NOVO</option>
                      <option value="RECAPADO">RECAPADO</option>
                      <option value="USADO">USADO</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td style="border: none; padding: 5px;" colspan="2" style="text-align: right;">
                    <button type="button" id="btn-filtrar-estoque" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                      <i class="fas fa-search" style="margin-right: 5px;"></i>Filtrar
                    </button>
                  </td>
                </tr>
              </table>

              <!-- Grid de Pneus em Estoque -->
              <div class="estoque-grid-wrapper" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 4px; margin-bottom: 15px;">
                <div id="estoque-grid-header" class="grid-header" style="display: flex; white-space: nowrap; background: linear-gradient(135deg, #28a745, #20c997); color: white; font-weight: 600; border-bottom: 2px solid #1e7e34; position: sticky; top: 0; z-index: 10;">
                  <div style="flex: 0.5; min-width: 50px; padding: 10px 8px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);"></div>
                  <div style="flex: 1; min-width: 100px; padding: 10px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-tag" style="margin-right: 5px;"></i>Marca</div>
                  <div style="flex: 1.5; min-width: 140px; padding: 10px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-cog" style="margin-right: 5px;"></i>Modelo</div>
                  <div style="flex: 0.8; min-width: 80px; padding: 10px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-shapes" style="margin-right: 5px;"></i>Tipo</div>
                  <div style="flex: 0.5; min-width: 50px; padding: 10px 8px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-recycle" style="margin-right: 5px;"></i>Vida</div>
                  <div style="flex: 0.8; min-width: 80px; padding: 10px 8px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-hashtag" style="margin-right: 5px;"></i>Qtd</div>
                  <div style="flex: 1; min-width: 120px; padding: 10px 8px; text-align: center;"><i class="fas fa-fire" style="margin-right: 5px;"></i>Marca Fogo</div>
                </div>
                <div id="estoque-grid-body" class="grid-body" style="background: #f8f9fa;">
                  <!-- Pneus ser√£o carregados dinamicamente -->
                </div>
              </div>

              <!-- Pneu Selecionado -->
              <div id="pneu-selecionado" style="background: #e9ecef; padding: 15px; border-radius: 6px; border: 1px solid #ced4da; display: none;">
                <h5 style="color: #495057; margin-bottom: 10px;"><i class="fas fa-check-circle" style="margin-right: 8px;"></i>Pneu Selecionado</h5>
                <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                  <div><strong>Marca:</strong> <span id="selecionado-marca"></span></div>
                  <div><strong>Modelo:</strong> <span id="selecionado-modelo"></span></div>
                  <div><strong>Tipo:</strong> <span id="selecionado-tipo"></span></div>
                  <div><strong>Vida:</strong> <span id="selecionado-vida"></span></div>
                  <div><strong>Dispon√≠vel:</strong> <span id="selecionado-quantidade"></span></div>
                  <div><strong>Marca Fogo:</strong> <span id="selecionado-codigo"></span></div>
                </div>
                <input type="hidden" name="marca" id="marca" />
                <input type="hidden" name="modelo" id="modelo" />
                <input type="hidden" name="tipo" id="tipo" />
                <input type="hidden" name="vida" id="vida" />
                <input type="hidden" name="codigo_marca_fogo_instalado" id="codigo_marca_fogo_instalado" />
                <div style="margin-top: 10px;">
                  <label>Quantidade a utilizar *</label>
                  <input type="number" name="quantidade" id="quantidade" min="1" value="1" required style="width: 80px; padding: 4px;" />
                </div>
              </div>
            </div>

            <div style="margin-top: 20px;">
              <label>Observa√ß√µes</label>
              <textarea name="observacoes" id="observacoes" rows="3" placeholder="Observa√ß√µes adicionais sobre a opera√ß√£o..." style="width: 100%; resize: vertical; min-height: 60px; padding: 10px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
            </div>
          </div>

          <div class="modal-actions" style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; padding-top: 20px; border-top: 1px solid #e9ecef;">
            <button type="submit" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);"><i class="fas fa-arrow-right" style="margin-right: 8px;"></i>Registrar Sa√≠da</button>
            <button type="button" onclick="limparFormulario()" style="background: linear-gradient(135deg, #6c757d, #5a6268); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);"><i class="fas fa-times" style="margin-right: 8px;"></i>Limpar</button>
          </div>
        </form>
      </div>

      <!-- Hist√≥rico de Sa√≠das -->
      <div class="table-card" id="historico-card" style="background: #fff; border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef; display: none;">
        <div class="table-header" style="border-bottom: 2px solid #28a745; padding-bottom: 15px; margin-bottom: 20px;">
          <h2 style="color: #28a745; margin: 0; font-size: 1.4rem;"><i class="fas fa-history" style="margin-right: 8px;"></i>Hist√≥rico de Sa√≠das</h2>
        </div>

        <div class="grid-wrapper" style="overflow-x: auto; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
          <section class="grid-pneus" style="min-width: max-content; display: flex; flex-direction: column; border-radius: 8px; overflow: hidden;">
            <div class="grid-header" style="display: flex; white-space: nowrap; background: linear-gradient(135deg, #dc3545, #c82333); color: white; font-weight: 600; border-bottom: 2px solid #bd2130;">
              <div style="flex: 1; min-width: 120px; padding: 15px 12px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-calendar" style="margin-right: 5px;"></i>Data</div>
              <div style="flex: 1; min-width: 100px; padding: 15px 12px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-cogs" style="margin-right: 5px;"></i>Opera√ß√£o</div>
              <div style="flex: 1; min-width: 100px; padding: 15px 12px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-road" style="margin-right: 5px;"></i>Km</div>
              <div style="flex: 1; min-width: 120px; padding: 15px 12px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-tag" style="margin-right: 5px;"></i>Marca</div>
              <div style="flex: 1.2; min-width: 140px; padding: 15px 12px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-cog" style="margin-right: 5px;"></i>Modelo</div>
              <div style="flex: 0.8; min-width: 100px; padding: 15px 12px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-shapes" style="margin-right: 5px;"></i>Tipo</div>
              <div style="flex: 1; min-width: 120px; padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-fire" style="margin-right: 5px;"></i>Marca Fogo</div>
              <div style="flex: 1; min-width: 120px; padding: 15px 12px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-user" style="margin-right: 5px;"></i>Usu√°rio</div>
              <div style="flex: 0.8; min-width: 100px; padding: 15px 12px; text-align: center;"><i class="fas fa-cogs" style="margin-right: 5px;"></i>A√ß√µes</div>
            </div>
            <div id="grid-historico-body" class="grid-body" style="background: #f8f9fa;"></div>
          </section>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    ¬© 2025 Marquespan. Todos os direitos reservados.
  </footer>

  <script type="module" src="./script/menu.js" defer></script>
  <script type="module" src="./script/saidas-pneus.js" defer></script>
</body>
</html>
