<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sa√≠das/Rod√≠zio de Pneus - Marquespan</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

  <main class="main-content">
    <header class="page-title-header"><i class="fas fa-arrow-right page-title-icon"></i><span class="page-title-text">Sa√≠das e Rod√≠zio de Pneus</span></header>
    <section class="content-section">

      <!-- Se√ß√£o de Tipo de Sa√≠da -->
      <div class="form-card card-saida">
        <div class="form-header header-section header-green">
          <h3><i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i>Tipo de Sa√≠da</h3>
        </div>
        <div class="form-grid grid-form">
          <label>Tipo de Sa√≠da *</label>
          <select name="tipo_saida" id="tipo_saida" required class="select-lg">
            <option value="">Selecione o Tipo</option>
            <option value="BORRACHARIA">Envio para Borracharia</option>
            <option value="VEICULO">Aplica√ß√£o em Ve√≠culo</option>
            <option value="TRANSFERENCIA CD">Transferencia para CD</option>
            <option value="DESCARTE">Descarte</option>
            <option value="AJUSTE">Ajuste de Estoque</option>
          </select>
        </div>
      </div>

      <!-- Visualiza√ß√£o das Posi√ß√µes Atuais -->
      <div class="form-card card-saida" id="posicoes-card" style="display: none;">
        <div class="form-header header-section header-blue">
          <h3><i class="fas fa-map-marker-alt" style="margin-right: 8px;"></i>Posi√ß√µes Atuais dos Pneus</h3>
        </div>
        <div id="posicoes-veiculo" class="posicoes-grid grid-posicoes">
          <!-- Posi√ß√µes ser√£o carregadas dinamicamente -->
        </div>
      </div>

      <!-- Card do Formul√°rio de Sa√≠da -->
      <div class="form-card card-saida" id="form-card" style="display: none;">
        <div class="form-header header-section header-red">
          <h3><i class="fas fa-arrow-right" style="margin-right: 8px;"></i>Registro de Sa√≠da</h3>
        </div>
        <form id="formSaida">
          <div class="form-bloco">
            <div class="form-grid grid-registro">
              <label>Data da Opera√ß√£o</label>
              <input type="datetime-local" name="data_operacao" id="data_operacao" readonly />
            </div>

            <!-- Campos Espec√≠ficos para Ve√≠culo/Aplica√ß√£o -->
            <div id="campos-veiculo-especificos" class="campos-grupo" style="display: none;">
              <div class="form-grid grid-registro">
                <div>
                  <label>Quilometragem do Ve√≠culo *</label>
                  <input type="number" name="quilometragem" id="quilometragem" min="0" placeholder="Ex: 150000" />
                </div>
                <div>
                  <label>Tipo de Opera√ß√£o *</label>
                  <select name="tipo_operacao" id="tipo_operacao">
                    <option value="">Selecione</option>
                    <option value="RODIZIO">üîÑ Rod√≠zio</option>
                    <option value="INSTALACAO">üì¶ Instala√ß√£o</option>
                    <option value="TROCA">üîß Troca</option>
                  </select>
                </div>
                <div>
                  <label>Aplica√ß√£o *</label>
                  <select name="aplicacao" id="aplicacao">
                    <option value="">Selecione</option>
                    <option value="DIANTEIRO">üöó Dianteiro</option>
                    <option value="TRACAO">üöõ Tra√ß√£o</option>
                    <option value="TRUCK">üöö Truck</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Campos Espec√≠ficos para Borracharia -->
            <div id="campos-borracharia-especificos" class="campos-grupo section-borracharia" style="display: none;">
              <h4><i class="fas fa-tools"></i> Dados do Envio</h4>
              <div class="form-grid grid-registro">
                <div>
                  <label>Tipo de Pneu (Lote) *</label>
                  <select name="tipo_pneu_borracharia" id="tipo_pneu_borracharia">
                    <option value="">Selecione o Tipo</option>
                    <option value="NOVO">Novo</option>
                    <option value="RECAPADO">Recapado</option>
                    <option value="USADO">Usado</option>
                    <option value="SUCATA">Sucata</option>
                  </select>
                </div>
                <div>
                  <label>Quantidade *</label>
                  <input type="number" name="quantidade_borracharia" id="quantidade_borracharia" min="1" placeholder="Qtd de pneus a enviar" />
                </div>
              </div>
              <div style="margin-top: 10px; font-size: 0.9rem; color: #555;">
                <i class="fas fa-info-circle"></i> Selecione abaixo as Marcas de Fogo correspondentes √† quantidade informada.
              </div>
            </div>

            <!-- Campos espec√≠ficos para rod√≠zio -->
            <div id="campos-rodizio" class="section-rodizio" style="display: none;">
              <h4><i class="fas fa-sync-alt" style="margin-right: 8px;"></i>Configura√ß√£o do Rod√≠zio</h4>
              <div class="form-grid grid-registro">

                <label>Posi√ß√£o Atual do Pneu</label>
                <select name="posicao_anterior" id="posicao_anterior">
                  <option value="">Selecione posi√ß√£o atual</option>
                  <option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option>
                  <option value="DIANTEIRO_DIREITO">Dianteiro Direito</option>
                  <option value="TRACAO_ESQUERDO">Tra√ß√£o Esquerdo</option>
                  <option value="TRACAO_DIREITO">Tra√ß√£o Direito</option>
                  <option value="TRUCK_ESQUERDO">Truck Esquerdo</option>
                  <option value="TRUCK_DIREITO">Truck Direito</option>
                </select>

                <label>Nova Posi√ß√£o</label>
                <select name="posicao_nova" id="posicao_nova">
                  <option value="">Selecione nova posi√ß√£o</option>
                  <option value="DIANTEIRO_ESQUERDO">Dianteiro Esquerdo</option>
                  <option value="DIANTEIRO_DIREITO">Dianteiro Direito</option>
                  <option value="TRACAO_ESQUERDO">Tra√ß√£o Esquerdo</option>
                  <option value="TRACAO_DIREITO">Tra√ß√£o Direito</option>
                  <option value="TRUCK_ESQUERDO">Truck Esquerdo</option>
                  <option value="TRUCK_DIREITO">Truck Direito</option>
                </select>

                <label>C√≥digo Marca de Fogo (Pneu a ser removido)</label>
                <input type="text" name="codigo_marca_fogo_trocado" id="codigo_marca_fogo_trocado" placeholder="Ex: MF001" maxlength="10" />

                <label>C√≥digo Marca de Fogo (Pneu a ser instalado)</label>
                <input type="text" name="codigo_marca_fogo_instalado" id="codigo_marca_fogo_instalado" placeholder="Ex: MF002" maxlength="10" />
              </div>
            </div>

            <!-- Sele√ß√£o de Pneu do Estoque -->
            <div class="section-selecao">
              <h4><i class="fas fa-boxes" style="margin-right: 8px;"></i>Sele√ß√£o do Pneu do Estoque</h4>

              <!-- Filtros para busca -->
              <table style="border: none; border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                <tr>
                  <td style="border: none; padding: 5px;"><label>Filtrar Marca</label></td>
                  <td style="border: none; padding: 5px;">
                    <select name="filtro_marca" id="filtro_marca">
                      <option value="">Todas</option>
                      <option value="BRIDGESTONE">BRIDGESTONE</option>
                      <option value="CONTINENTAL">CONTINENTAL</option>
                      <option value="GOODYEAR">GOODYEAR</option>
                      <option value="MICHELIN">MICHELIN</option>
                      <option value="PIRELLI">PIRELLI</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td style="border: none; padding: 5px;"><label>Filtrar Modelo</label></td>
                  <td style="border: none; padding: 5px;">
                    <select name="filtro_modelo" id="filtro_modelo">
                      <option value="">Todos</option>
                      <option value="225/75/16">225/75/16</option>
                      <option value="235/75/17.5">235/75/17.5</option>
                      <option value="275/80/22.5 - LISO">275/80/22.5 - LISO</option>
                      <option value="275/80/22.5 - BORRACHUDO">275/80/22.5 - BORRACHUDO</option>
                      <option value="295/80/22.5 - LISO">295/80/22.5 - LISO</option>
                      <option value="295/80/22.5 - BORRACHUDO">295/80/22.5 - BORRACHUDO</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td style="border: none; padding: 5px;"><label>Filtrar Tipo</label></td>
                  <td style="border: none; padding: 5px;">
                    <select name="filtro_tipo" id="filtro_tipo">
                      <option value="">Todos</option>
                      <option value="NOVO">NOVO</option>
                      <option value="RECAPADO">RECAPADO</option>
                      <option value="USADO">USADO</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td style="border: none; padding: 5px;" colspan="2" style="text-align: right;">
                    <button type="button" id="btn-filtrar-estoque" class="btn-filtrar">
                      <i class="fas fa-search" style="margin-right: 5px;"></i>Filtrar
                    </button>
                  </td>
                </tr>
              </table>

              <!-- Grid de Pneus em Estoque -->
              <div class="estoque-grid-wrapper estoque-wrapper">
                <div id="estoque-grid-header" class="grid-header grid-header-sticky header-estoque">
                  <div class="grid-cell-header" style="flex: 0.5; min-width: 50px; text-align: center;"></div>
                  <div class="grid-cell-header" style="flex: 1; min-width: 100px; text-align: left;"><i class="fas fa-tag" style="margin-right: 5px;"></i>Marca</div>
                  <div class="grid-cell-header" style="flex: 1.5; min-width: 140px; text-align: left;"><i class="fas fa-cog" style="margin-right: 5px;"></i>Modelo</div>
                  <div class="grid-cell-header" style="flex: 0.8; min-width: 80px; text-align: left;"><i class="fas fa-shapes" style="margin-right: 5px;"></i>Tipo</div>
                  <div class="grid-cell-header" style="flex: 0.5; min-width: 50px; text-align: center;"><i class="fas fa-recycle" style="margin-right: 5px;"></i>Vida</div>
                  <div class="grid-cell-header" style="flex: 0.8; min-width: 80px; text-align: center;"><i class="fas fa-hashtag" style="margin-right: 5px;"></i>Qtd</div>
                  <div class="grid-cell-header" style="flex: 1; min-width: 120px; text-align: center; border-right: none;"><i class="fas fa-fire" style="margin-right: 5px;"></i>Marca Fogo</div>
                </div>
                <div id="estoque-grid-body" class="grid-body" style="background: #f8f9fa;">
                  <!-- Pneus ser√£o carregados dinamicamente -->
                </div>
              </div>

              <!-- Pneu Selecionado -->
              <div id="pneu-selecionado" class="box-pneu-selecionado" style="display: none;">
                <h5><i class="fas fa-check-circle" style="margin-right: 8px;"></i>Pneu Selecionado</h5>
                <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 10px;">
                  <div><strong>Marca:</strong> <span id="selecionado-marca"></span></div>
                  <div><strong>Modelo:</strong> <span id="selecionado-modelo"></span></div>
                  <div><strong>Tipo:</strong> <span id="selecionado-tipo"></span></div>
                  <div><strong>Vida:</strong> <span id="selecionado-vida"></span></div>
                  <div><strong>Dispon√≠vel:</strong> <span id="selecionado-quantidade"></span></div>
                  <div><strong>Marca Fogo:</strong> <span id="selecionado-codigo"></span></div>
                </div>
                <input type="hidden" name="marca" id="marca" />
                <input type="hidden" name="modelo" id="modelo" />
                <input type="hidden" name="tipo" id="tipo" />
                <input type="hidden" name="vida" id="vida" />
                <input type="hidden" name="codigo_marca_fogo_instalado" id="codigo_marca_fogo_instalado" />
                <div style="margin-top: 10px;">
                  <label id="lbl-qtd-utilizar">Quantidade a utilizar *</label>
                  <input type="number" name="quantidade" id="quantidade" min="1" value="1" style="width: 80px; padding: 4px;" />
                  
                  <!-- Bot√£o para adicionar √† lista (Borracharia) -->
                  <button type="button" id="btn-add-lista-borracharia" class="btn-add-lista" style="display: none; margin-left: 10px;">
                    <i class="fas fa-plus"></i> Adicionar √† Lista
                  </button>
                </div>
              </div>
            </div>

            <!-- Lista de Pneus Selecionados (Para Borracharia/M√∫ltiplos) -->
            <div id="lista-pneus-selecionados-container" style="display: none; margin-top: 20px;">
              <h4 style="color: #28a745; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Itens Selecionados para Sa√≠da</h4>
              <table class="data-grid" style="width: 100%; margin-top: 10px;">
                <thead>
                  <tr>
                    <th>Marca Fogo</th>
                    <th>Marca/Modelo</th>
                    <th>Tipo</th>
                    <th>A√ß√£o</th>
                  </tr>
                </thead>
                <tbody id="tbody-pneus-selecionados">
                  <!-- Itens adicionados via JS -->
                </tbody>
              </table>
              <input type="hidden" name="pneus_selecionados_json" id="pneus_selecionados_json">
            </div>

            <div style="margin-top: 20px;">
              <label>Observa√ß√µes</label>
              <textarea name="observacoes" id="observacoes" rows="3" placeholder="Observa√ß√µes adicionais sobre a opera√ß√£o..." style="width: 100%; resize: vertical; min-height: 60px; padding: 10px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
            </div>
          </div>

          <div class="modal-actions" style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; padding-top: 20px; border-top: 1px solid #e9ecef;">
            <button type="submit" class="btn-registrar"><i class="fas fa-arrow-right" style="margin-right: 8px;"></i>Registrar Sa√≠da</button>
            <button type="button" onclick="limparFormulario()" class="btn-limpar"><i class="fas fa-times" style="margin-right: 8px;"></i>Limpar</button>
          </div>
        </form>
      </div>

      <!-- Hist√≥rico de Sa√≠das -->
      <div class="table-card card-saida" id="historico-card" style="display: none;">
        <div class="table-header header-section header-green">
          <h2><i class="fas fa-history" style="margin-right: 8px;"></i>Hist√≥rico de Sa√≠das</h2>
        </div>

        <div class="grid-wrapper" style="overflow-x: auto; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
          <section class="grid-pneus" style="min-width: max-content; display: flex; flex-direction: column; border-radius: 8px; overflow: hidden;">
            <div class="grid-header header-historico-grid" style="display: flex; white-space: nowrap; font-weight: 600;">
              <div class="grid-cell-header-lg" style="flex: 1; min-width: 120px; text-align: left;"><i class="fas fa-calendar" style="margin-right: 5px;"></i>Data</div>
              <div class="grid-cell-header-lg" style="flex: 1; min-width: 100px; text-align: left;"><i class="fas fa-cogs" style="margin-right: 5px;"></i>Opera√ß√£o</div>
              <div class="grid-cell-header-lg" style="flex: 1; min-width: 100px; text-align: left;"><i class="fas fa-road" style="margin-right: 5px;"></i>Km</div>
              <div class="grid-cell-header-lg" style="flex: 1; min-width: 120px; text-align: left;"><i class="fas fa-tag" style="margin-right: 5px;"></i>Marca</div>
              <div class="grid-cell-header-lg" style="flex: 1.2; min-width: 140px; text-align: left;"><i class="fas fa-cog" style="margin-right: 5px;"></i>Modelo</div>
              <div class="grid-cell-header-lg" style="flex: 0.8; min-width: 100px; text-align: left;"><i class="fas fa-shapes" style="margin-right: 5px;"></i>Tipo</div>
              <div class="grid-cell-header-lg" style="flex: 1; min-width: 120px; text-align: center;"><i class="fas fa-fire" style="margin-right: 5px;"></i>Marca Fogo</div>
              <div class="grid-cell-header-lg" style="flex: 1; min-width: 120px; text-align: left;"><i class="fas fa-user" style="margin-right: 5px;"></i>Usu√°rio</div>
              <div class="grid-cell-header-lg" style="flex: 0.8; min-width: 100px; text-align: center; border-right: none;"><i class="fas fa-cogs" style="margin-right: 5px;"></i>A√ß√µes</div>
            </div>
            <div id="grid-historico-body" class="grid-body" style="background: #f8f9fa;"></div>
          </section>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    ¬© 2025 Marquespan. Todos os direitos reservados.
  </footer>

  <script type="module" src="./script/menu.js" defer></script>
  <script type="module" src="./script/saidas-pneus.js" defer></script>
</body>
</html>
