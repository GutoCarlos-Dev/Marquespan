<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gest√£o de Usu√°rios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>


  <!-- üß± Conte√∫do principal -->
  <div class="main-content">
    <header class="header">üë• Gest√£o de Usu√°rios</header>

    <section id="cadastro" class="secao hidden">
      <h3>üìã Cadastro de Usu√°rios</h3>
      <form id="formUsuario" class="formulario">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" placeholder="Nome" required>
        <label for="nomecompleto">Nome Completo:</label>
        <input type="text" id="nomecompleto" placeholder="Nome Completo" required>
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="Email" autocomplete="email" required>
        <label for="nivel">N√≠vel:</label>
        <select id="nivel" required>
          <option value="" disabled selected>Selecione o n√≠vel</option>
          <option value="administrador">Administrador</option>
          <option value="carregamento">Carregamento</option>
          <option value="compras">Compras</option>
          <option value="estoque">Estoque</option>
          <option value="matriz">Matriz</option>
          <option value="operador">Operador</option>
        </select>
        <label for="senha">Senha:</label>
        <input type="password" id="senha" placeholder="Senha (deixe vazio para manter a atual)" autocomplete="current-password">

        <div class="botoes-form">
          <button type="submit" id="btnSalvar">‚úÖ Cadastrar</button>
          <button type="submit" id="btnAtualizar" class="hidden">üîÑ Salvar</button>
          <button type="button" onclick="window.location.href='dashboard.html'">‚¨ÖÔ∏è Voltar</button>
        </div>
      </form>
    </section>

    <section id="busca" class="secao">
      <h3>üîç Buscar Usu√°rios</h3>
      <div class="campo-busca">
        <input type="text" id="termoBusca" placeholder="Digite o nome, email ou c√≥digo do usu√°rio">
      </div>

      <div class="botoes-form">
        <button id="btnAtualizarLista">üîÑ Atualizar Lista</button>
        <button id="btnAdicionarNovo" onclick="mostrarSecao('cadastro')">‚ûï Adicionar Novo</button>
      </div>

      <table id="tabelaUsuarios" class="tabela-usuarios">
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Nome</th>
            <th>Nome Completo</th>
            <th>Email</th>
            <th>N√≠vel</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="corpoTabelaUsuarios"></tbody>
      </table>
    </section>

    <footer class="footer">
      &copy; 2025 Marquespan. Todos os direitos reservados.
    </footer>
  </div>

  <!-- üöÄ Scripts -->
  <!-- 1. Carrega a biblioteca do Supabase a partir do CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- 2. Inicializa o cliente Supabase e o torna global -->
  <script>
    const supabaseUrl = 'https://hlzcycvlcuhgnnjkmslt.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhsemN5Y3ZsY3VoZ25uamttc2x0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwODA1ODgsImV4cCI6MjA2OTY1NjU4OH0.GEm-OCzpScQ5uFvhkNFHxdKdwZc3W2bnxphq0pjBwxY';
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
  </script>

  <!-- 3. Carrega os scripts da p√°gina -->
  <script src="./script/menu.js" defer></script>
  <script src="./script/usuarios.js" defer></script>

  <script>
    function mostrarSecao(id) {
      document.querySelectorAll('.secao').forEach(sec => sec.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      // Limpa e reseta o formul√°rio ao alternar para a se√ß√£o de cadastro
      if (id === 'cadastro') {
        document.getElementById('formUsuario').reset();
        document.getElementById('btnSalvar').classList.remove('hidden');
        document.getElementById('btnAtualizar').classList.add('hidden');
        document.getElementById('formUsuario').dataset.usuarioId = '';
      }
    }
    window.mostrarSecao = mostrarSecao;

    window.onload = () => {
      document.getElementById('btnAtualizarLista').addEventListener('click', mostrarUsuarios);
      document.getElementById('termoBusca').addEventListener('input', mostrarUsuarios);
      document.getElementById('formUsuario').addEventListener('submit', cadastrarUsuario); // Simplificado para chamar a fun√ß√£o correta
      document.getElementById('btnAtualizar').addEventListener('click', atualizarUsuario);
      mostrarUsuarios();
    };
  </script>
</body>
</html>
